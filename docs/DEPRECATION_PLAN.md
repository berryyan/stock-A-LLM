# 老系统废弃计划

**创建日期**: 2025-07-06  
**目标版本**: v2.4.0  
**状态**: 计划中

## 时间线

### 2025-07 至 2025-08：并行运行期
- ✅ v2.2.0发布，模块化API上线（端口8001）
- ⏳ 老API（端口8000）继续运行，添加废弃警告
- ⏳ 监控两个API的使用情况
- ⏳ 收集用户反馈

### 2025-09：功能冻结期
- ⏳ 老系统停止新功能开发
- ⏳ 仅修复P0/P1级别bug
- ⏳ API响应头添加`X-Deprecated: true`
- ⏳ 发送迁移通知给所有用户

### 2025-10 第1-2周：只读模式
- ⏳ 老系统进入只读模式
- ⏳ 所有写入操作返回迁移提示
- ⏳ 最后迁移窗口期

### 2025-10 第3周：完全移除
- ⏳ 删除老系统代码
- ⏳ 8000端口重定向到8001
- ⏳ 发布v2.4.0版本

## 迁移清单

### 代码层面
- [ ] 在`api/main.py`添加启动警告
- [ ] 在所有响应中添加废弃提示
- [ ] 创建自动迁移脚本
- [ ] 更新CI/CD配置

### 文档层面
- [ ] 创建详细的迁移指南
- [ ] 更新所有API文档
- [ ] 更新示例代码
- [ ] 创建FAQ文档

### 用户通知
- [ ] 发布废弃公告
- [ ] 邮件通知活跃用户
- [ ] 在Web界面显示迁移提示
- [ ] 提供迁移支持热线

## 监控指标

### 使用率监控
```python
# 添加到api/main.py
@app.middleware("http")
async def track_usage(request: Request, call_next):
    # 记录API使用情况
    logger.info(f"Legacy API called: {request.url.path}")
    # 可以记录到数据库或监控系统
    response = await call_next(request)
    return response
```

### 迁移进度
- 老API日均请求量
- 新API日均请求量
- 迁移完成率 = 新API请求量 / (新API + 老API请求量)

## 风险管理

### 潜在风险
1. **用户抵制迁移**
   - 缓解：提供充足的迁移时间和支持
   
2. **第三方集成中断**
   - 缓解：提前通知，提供迁移工具

3. **性能回退**
   - 缓解：保留紧急回滚方案

### 回滚计划
如果出现严重问题：
1. 保留老系统代码的git tag
2. 可以快速恢复老API
3. 延长废弃时间线

## 成功标准

- [ ] 95%以上的流量迁移到新API
- [ ] 零服务中断事故
- [ ] 用户满意度保持在90%以上
- [ ] 代码维护成本降低50%

## 负责人

- 技术负责人：架构团队
- 迁移协调：DevOps团队
- 用户沟通：产品团队
- 文档更新：技术文档团队