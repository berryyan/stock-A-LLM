# Concept Agent Day 4 开发计划

创建时间：2025-07-18  
预计完成时间：2025-07-18

## Day 4 目标

基于Day 3完成的数据采集和评分系统，Day 4的主要目标是：
1. 集成评分系统到ConceptAgent
2. 修复数据源问题
3. 优化评分算法
4. 完成端到端测试

## Day 3 关键发现回顾

### 已完成功能
- ✅ TechnicalCollector技术指标采集
- ✅ MoneyFlowCollector资金流向采集  
- ✅ ConceptScorer多维度评分系统
- ✅ 基础测试脚本

### 发现的问题
1. **评分偏低**（最高仅9.2/100）
   - 概念关联度数据不完整（缺少财报、公告、互动平台数据）
   - 大部分股票资金流出
   - 技术指标表现一般

2. **数据源错误**
   - 东财SQL查询有语法错误（`leading`是保留字）
   - 开盘啦参数绑定错误（`concept_0` vs `theme_0`）

3. **接口设计**
   - 所有采集器无参数初始化
   - 内部管理数据库连接
   - 统一的批量查询接口

## Day 4 详细任务清单

### 任务1：修复数据源SQL错误（优先级：高）

**1.1 修复东财SQL查询**
- 问题：`leading`是MySQL保留字
- 解决：使用反引号或别名
- 文件：`utils/concept/concept_data_collector.py`

**1.2 修复开盘啦参数绑定**
- 问题：参数名不匹配（`concept_0` vs `theme_0`）
- 解决：统一参数名
- 文件：`utils/concept/concept_data_collector.py`

### 任务2：优化评分算法（优先级：高）

**2.1 调整评分权重和阈值**
- 降低概念关联度的基础分要求
- 调整资金流向的评分标准
- 优化技术指标的判断逻辑

**2.2 添加默认值处理**
- 为缺失的财报/公告数据提供合理默认值
- 实现渐进式评分（有数据加分，无数据不扣分）

### 任务3：集成到ConceptAgent（优先级：高）

**3.1 验证现有集成**
- ConceptAgent已经导入了所有必要的模块
- run方法已经调用了数据采集和评分
- 需要验证整个流程是否正常

**3.2 优化报告生成**
- 改进`_generate_concept_report`方法
- 增加评分解释和投资建议
- 优化输出格式

### 任务4：创建端到端测试（优先级：中）

**4.1 创建完整测试脚本**
- 测试从查询到结果的完整流程
- 包含多种查询类型测试
- 验证错误处理

**4.2 性能测试**
- 测试响应时间
- 测试并发处理能力
- 记录性能基准

### 任务5：文档更新（优先级：低）

**5.1 更新技术文档**
- 记录修复的问题
- 更新API文档
- 添加使用示例

## 执行顺序

1. **Phase 1（上午）**：修复数据源问题
   - 修复东财SQL错误
   - 修复开盘啦参数绑定
   - 验证数据获取正常

2. **Phase 2（下午）**：优化和集成
   - 优化评分算法
   - 验证ConceptAgent集成
   - 创建端到端测试

3. **Phase 3（晚上）**：测试和文档
   - 运行完整测试
   - 更新文档
   - 准备Day 5计划

## 成功标准

1. **数据源修复**
   - 东财和开盘啦数据正常获取
   - 无SQL错误

2. **评分优化**
   - 评分分布更合理（最高分>50）
   - 有明显的梯度差异

3. **Agent集成**
   - 端到端查询正常工作
   - 响应时间<10秒
   - 输出格式清晰易读

4. **测试覆盖**
   - 所有主要功能有测试
   - 错误处理正常

## 风险和注意事项

1. **数据完整性**
   - 财报/公告数据暂时无法获取
   - 需要在评分中合理处理

2. **性能考虑**
   - 批量查询可能较慢
   - 需要考虑缓存策略

3. **向后兼容**
   - 修改时注意不影响其他Agent
   - 保持接口一致性

## 开发原则

1. **测试驱动**：先写测试，再改代码
2. **小步迭代**：每个修改都要验证
3. **保持沟通**：重要决策需要确认
4. **文档同步**：代码修改同步更新文档

## 备注

- 严格遵循项目开发规范
- 使用中文注释和文档
- 测试时激活虚拟环境
- 避免盲目编码，每步都要验证