# Concept Agent Day 5 开发计划

更新时间：2025-07-18

## Day 5 目标调整

基于Day 4发现的问题和用户建议，Day 5的重点从"新闻分析"调整为"数据源调查与性能优化"。

## 主要任务

### 1. 数据源深度调查（优先级：高）

#### 1.1 查询原始数据库内容
- **同花顺概念**：查询tu_ths_index表的概念名称
- **东财板块**：查询tu_dc_index表的板块名称
- **开盘啦题材**：查询tu_kpl_concept_list表的题材名称

#### 1.2 找到通用测试用例
- 查找三个数据源都有的概念/板块/题材
- 用于验证数据集成功能

#### 1.3 找到独特测试用例
- 同花顺独有的概念
- 东财独有的板块
- 开盘啦独有的题材
- 用于验证各数据源独立功能

#### 1.4 概念名称映射方案
- 建立概念名称对照表
- 实现智能匹配算法

### 2. 性能优化（优先级：高）

#### 2.1 查询优化
- 限制单次查询的股票数量（TOP 100）
- 实现分页查询机制
- 优化SQL查询性能

#### 2.2 批量处理优化
- 增大批量查询的批次大小（从50到100）
- 实现并发批量查询
- 添加进度提示

#### 2.3 缓存增强
- 增加查询结果缓存
- 实现分层缓存策略
- 优化缓存过期机制

### 3. 评分算法进一步优化（优先级：中）

#### 3.1 动态权重调整
- 根据数据完整度调整权重
- 实现相对评分机制

#### 3.2 增加评分维度
- 添加板块相对强度
- 增加成交量活跃度
- 考虑市值规模因素

### 4. 测试与验证（优先级：高）

#### 4.1 创建综合测试套件
- 数据源测试（含通用和独特用例）
- 性能测试（响应时间、并发能力）
- 评分准确性测试

#### 4.2 问题修复
- 修复LLM响应格式问题
- 优化错误处理机制

## 执行顺序

1. **第一步**：数据库调查（1小时）
   - 查询三个数据源的实际数据
   - 分析概念名称差异
   - 确定测试用例

2. **第二步**：创建测试用例（30分钟）
   - 编写数据源测试脚本
   - 包含通用和独特测试用例

3. **第三步**：数据源问题修复（2小时）
   - 实现概念名称映射
   - 修复匹配逻辑
   - 验证各数据源正常工作

4. **第四步**：性能优化（2小时）
   - 实现查询限制
   - 优化批量处理
   - 添加进度提示

5. **第五步**：评分优化（1小时）
   - 调整评分算法
   - 添加新维度
   - 测试评分效果

6. **第六步**：综合测试（1小时）
   - 运行完整测试套件
   - 记录性能指标
   - 整理问题列表

## 预期成果

1. **数据源正常工作**
   - 三个数据源都能返回数据
   - 概念名称映射机制完善

2. **性能显著提升**
   - 大批量查询不再超时
   - 响应时间控制在10秒内

3. **评分更加合理**
   - 平均分提升到40分以上
   - 评分分布更加均匀

4. **测试覆盖完整**
   - 各种场景都有测试用例
   - 问题能够快速定位

## 风险与应对

1. **风险**：概念名称差异太大难以映射
   - **应对**：建立人工映射表，逐步完善

2. **风险**：性能优化效果有限
   - **应对**：考虑异步处理，分批返回结果

3. **风险**：评分算法调整破坏原有逻辑
   - **应对**：保留原算法，新建优化版本

## 成功标准

- [ ] 东财和开盘啦能够返回数据
- [ ] 处理500只股票在10秒内完成
- [ ] 评分最高分达到50分以上
- [ ] 所有测试用例通过

## 注意事项

1. 遵循项目开发规范
2. 所有代码添加中文注释
3. 测试脚本使用虚拟环境
4. 及时更新文档