# v2.2.0 开发规划文档

## 一、4个新Agent详细需求

### 1. Rank Agent - 排名分析Agent
- **触发词**: "排名分析："
- **职责**: 专门处理各类排名查询的深度分析

### 2. ANNS Agent - 公告查询Agent  
- **触发词**: "查询公告："
- **职责**: 专门处理公告内容的检索和分析

### 3. QA Agent - 董秘互动Agent
- **触发词**: "董秘互动："
- **职责**: 处理投资者问答相关查询

### 4. Concept Agent - 概念股分析Agent（新增）
- **触发词**: "概念股分析："
- **核心功能**:
  1. 根据关键词搜索东财、同花顺、开盘啦等平台的概念分类
  2. 获取概念下的所有成分股列表
  3. 通过上交所、深交所互动平台信息扩展相关概念股
  4. 批量获取概念股的核心数据：
     - 资金流向数据
     - 行情形态（价格走势、成交量等）
     - 技术指标（如果有数据支持）
  5. 尝试分析每只股票加入该概念的原因/逻辑
  6. 生成综合分析报告

## 二、SQL Agent模板现状与扩展计划

### 已实现的模板（需要优化而非新增）
1. **历史K线查询** ✅ 
   - 现有: `KLINE_RANGE`, `HISTORICAL_KLINE`
   - 优化方向: 增加更多聚合统计功能

2. **历史交易量查询** ✅
   - 现有: `VOLUME_BY_DATE`, `VOLUME_RANKING`
   - 优化方向: 增加月度/季度/年度统计

3. **财务指标对比** ⚠️ 部分实现
   - 现有: 单股查询已实现
   - 需要: 多股票横向对比功能

### 需要新增的模板
1. **技术指标查询** ❌
   - 挑战: 数据库缺少技术指标表
   - 方案: 基于K线数据实时计算
   - 指标列表:
     - MA（5/10/20/60日均线）
     - MACD
     - KDJ
     - RSI
     - BOLL布林带

2. **板块成分股查询** ⚠️
   - 现有: `SECTOR_STOCKS`模板
   - 问题: 缺少完整的板块成分股映射表
   - 需要: 补充数据源

### SQL Agent优化方向
1. **增强聚合统计能力**
   - 时间维度聚合（日/周/月/季/年）
   - 多维度交叉分析

2. **实现简单技术指标计算**
   - 利用SQL窗口函数计算MA
   - 实现基础技术指标

3. **优化多股票对比查询**
   - 动态SQL生成
   - 结果格式化优化

## 三、开发优先级

### Phase 2: Agent适配（当前任务）
1. SQL Agent适配到模块化架构
2. RAG Agent适配
3. Financial Agent适配  
4. Money Flow Agent适配
5. 集成测试

### Phase 3: SQL模板扩展
1. 技术指标计算模板开发
2. 多股票对比功能增强
3. 聚合统计功能优化
4. 性能优化

### Phase 4: 新Agent开发
1. 设计文档编写（需用户审批）
2. Concept Agent开发（优先级高）
3. 其他3个Agent开发
4. 集成测试

## 四、数据需求

1. **板块成分股数据**
   - 需要完整的板块-股票映射表
   - 考虑从外部数据源获取

2. **概念股数据**
   - 东财概念分类数据
   - 同花顺概念数据
   - 互动平台关键词提取

3. **技术指标支持**
   - 评估是否需要预计算并存储
   - 或采用实时计算方案

## 五、风险点

1. **数据源限制**
   - 概念股数据需要外部API或爬虫
   - 技术指标计算可能影响查询性能

2. **复杂度控制**
   - 4个新Agent增加系统复杂度
   - 需要良好的模块化设计

3. **性能考虑**
   - 概念股批量查询可能耗时较长
   - 需要考虑异步处理或分页

---
更新时间: 2025-07-05
版本: v2.2.0-planning