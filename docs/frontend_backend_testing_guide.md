# 前后端连测指南

**更新时间**: 2025-07-06  
**版本**: v2.2.0-dev  
**状态**: 🟡 准备就绪（需要验证）

## 📋 当前准备情况

### ✅ 已完成
1. **模块化Agent全部完成**（5个Agent）
2. **模块化API导入问题修复**
3. **前端环境配置文件创建**（.env.modular）
4. **统一启动脚本创建**（start_modular_system.bat）
5. **API测试脚本准备**（test_modular_api.py）

### 🟡 待验证
1. 模块化API能否正常启动
2. 前端能否正确连接到模块化API
3. 所有功能是否正常工作

## 🚀 前后端连测步骤

### 1. 启动模块化系统

#### 方法一：使用统一启动脚本（推荐）
```bash
# Windows环境
start_modular_system.bat
```

#### 方法二：分别启动
```bash
# 1. 启动模块化API（端口8001）
conda activate stock-frontend
python -m uvicorn api.main_modular:app --reload --host 0.0.0.0 --port 8001

# 2. 启动前端（新窗口）
cd frontend
copy .env.modular .env.local
npm run dev
```

### 2. 验证系统状态

#### 2.1 验证API
```bash
# 运行API测试脚本
python test_modular_api.py
```

期望结果：
- ✅ 健康检查成功
- ✅ SQL查询成功
- ✅ 版本显示：2.2.0-modular

#### 2.2 访问Web界面
- 前端地址：http://localhost:5173
- API文档：http://localhost:8001/docs

### 3. 功能测试清单

#### 基础功能测试
- [ ] SQL查询：输入"贵州茅台最新股价"
- [ ] 财务分析：输入"分析贵州茅台的财务健康度"
- [ ] 资金流向：输入"分析贵州茅台的资金流向"
- [ ] RAG查询：输入"贵州茅台最新公告内容"（可能需要额外验证）

#### 响应时间测试
- [ ] SQL快速查询：< 2秒
- [ ] 财务分析：< 60秒
- [ ] 资金流向分析：< 30秒

#### 错误处理测试
- [ ] 输入错误股票代码
- [ ] 输入空查询
- [ ] 输入不支持的查询

## ⚠️ 注意事项

### 端口配置
- **原始API**: 端口8000
- **模块化API**: 端口8001
- **前端开发服务器**: 端口5173

### 环境变量
前端会使用`.env.local`文件配置API地址：
```
VITE_API_BASE_URL=http://localhost:8001
```

### 已知问题
1. RAG Agent的Milvus字段名已修复，但文档搜索功能需要验证
2. 首次启动可能需要较长时间初始化
3. 某些复杂查询可能超时（已设置120秒超时）

## 🔧 故障排除

### API无法启动
1. 检查端口8001是否被占用
2. 确认conda环境已激活
3. 检查Python依赖是否完整

### 前端无法连接API
1. 确认.env.local文件存在且配置正确
2. 检查浏览器控制台错误信息
3. 确认API服务正在运行

### 查询失败
1. 查看API日志输出
2. 检查specific Agent的初始化状态
3. 验证数据库连接是否正常

## 📊 测试报告模板

```
测试时间：2025-07-06 XX:XX
测试版本：v2.2.0-dev
测试环境：Windows 10

基础功能测试结果：
- SQL查询：✅/❌ （耗时：XX秒）
- 财务分析：✅/❌ （耗时：XX秒）
- 资金流向：✅/❌ （耗时：XX秒）
- RAG查询：✅/❌ （耗时：XX秒）

问题记录：
1. [问题描述]
2. [问题描述]

总体评价：
[系统是否可用于生产环境]
```

## 🎯 成功标准

前后端连测成功的标准：
1. 所有基础功能测试通过
2. 响应时间符合预期
3. 错误处理正常
4. 用户界面交互流畅
5. 无严重错误或崩溃

---

**准备完成！** 现在可以开始前后端连测了。