# 数据更新限制说明

## 概述

本文档记录系统中各数据表的更新状态限制，帮助开发者和用户理解某些查询返回历史数据的原因。

## 数据表更新状态（截至 2025-07-01）

### 1. tu_daily_basic 表
- **最新数据日期**: 2025-06-23
- **影响的查询**:
  - 市值排名（总市值、流通市值）
  - PE/PB 等估值指标
  - 换手率查询
- **用户影响**: 查询"最新"市值排名时，只能返回 2025-06-23 的数据

### 2. tu_daily_detail 表
- **最新数据日期**: 2025-07-01
- **影响的查询**:
  - 股价查询
  - 涨跌幅排名
  - 成交量/成交额查询
  - K线数据
- **用户影响**: 这些查询可以获取到最新交易日的数据

### 3. tu_moneyflow_dc 表
- **最新数据日期**: 2025-07-01
- **影响的查询**:
  - 资金流向分析
  - 主力净流入排名
  - 各级别资金分布
- **用户影响**: 资金流向查询可以获取到最新数据

## 处理建议

### 1. 用户提示
当用户查询涉及 `tu_daily_basic` 表的最新数据时，应该：
- 明确告知返回的是 2025-06-23 的数据
- 解释这是由于数据源更新延迟
- 避免用户误解为系统故障

### 2. 代码处理
```python
# 示例：在查询结果中添加数据日期说明
if query_type in ['市值排名', '估值指标'] and '最新' in query:
    result += "\n\n注：由于数据源限制，市值和估值数据更新至2025-06-23"
```

### 3. 未来改进
- 考虑实现数据源状态监控
- 在 API 响应中包含数据时效性信息
- 开发数据更新检查工具

## 受影响的快速路由模板

以下模板在查询"最新"数据时会返回历史数据：

1. **市值排名类**
   - MARKET_CAP_RANKING
   - CIRC_MV_RANKING

2. **估值指标类**
   - VALUATION_METRICS
   - VALUATION_METRICS_BY_DATE

3. **成交数据类**（当需要换手率时）
   - VOLUME_BY_DATE

## 验证命令

```bash
# 检查各表最新数据日期
python verify_data_update_date.py

# 测试受影响的查询
python test_market_cap_date_issue.py
```

## 更新历史

- 2025-07-01: 首次记录，发现 tu_daily_basic 更新延迟问题