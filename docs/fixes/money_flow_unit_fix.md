# 资金流向单位显示修复说明

**修复日期**: 2025-07-02  
**版本**: v2.1.9

## 问题描述

用户反馈主力净流入/流出排名的金额单位显示错误。

### 具体现象
- 表格标题显示"主力净流入(万)"
- 但实际显示的数值如"7.52"，对应实际金额75235.15万元
- 相当于把万元当成了亿元显示

## 问题分析

### 数据库字段说明
- `tu_moneyflow_dc`表中的`net_amount`字段单位是**万元**
- 例如：net_amount = 75235.15 表示75235.15万元

### 代码错误
```python
# 错误代码（utils/sql_templates.py 第613行）
net_mf = row.get('net_amount', 0) / 10000  # 错误：又除了一次10000
```

由于数据库中已经是万元单位，再除以10000实际上变成了亿元，但表头仍显示"万元"。

## 修复方案

直接使用net_amount的值，不需要除以10000：

```python
# 修复后代码
net_mf = row.get('net_amount', 0)  # 直接使用，已经是万元单位
```

## 验证结果

修复前：
```
| 1 | 通威股份 | 600438.SH | 17.80 | 10.01% | 7.52 | 22.19% |
```

修复后：
```
| 1 | 通威股份 | 600438.SH | 17.80 | 10.01% | 75235.15 | 22.19% |
```

## 影响范围

此修复影响：
- 主力净流入排名查询
- 主力净流出排名查询
- 相关的快速路由模板

## 经验教训

1. 使用数据库字段前，务必确认字段的单位定义
2. 避免重复的单位转换
3. 表格标题的单位说明必须与实际数据单位一致