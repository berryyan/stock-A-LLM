# 中文数字识别功能设计方案（暂缓开发）

**创建日期**: 2025-07-03 23:21  
**状态**: 暂缓开发  
**决策原因**: 为保证系统快速开发和迭代，暂时不增加此功能

## 背景

在SQL Agent的快速模板已经实现的情况下，用户反馈希望支持"前十"、"前二十"等中文数字表达。经过讨论和评估，决定暂缓此功能的开发。

## 功能设计方案（供未来参考）

### 1. 功能范围定义

**计划支持的中文数字表达**：
- 基础数字：一、二、三...九、十
- 十位数：十一、十二...二十、三十...九十
- 常用表达：前十、前二十、前五十、前一百
- TOP格式：TOP十、TOP二十（混合使用）

**不支持的范围**：
- 百位以上：一百五十（建议用户直接用150）
- 传统大写：壹、贰、叁
- 复杂组合：二十三（暂时只支持整十数）

### 2. 技术实现方案

创建 `utils/chinese_number_converter.py`：

```python
# 核心转换映射
CHINESE_NUMBER_MAP = {
    '一': 1, '二': 2, '三': 3, '四': 4, '五': 5,
    '六': 6, '七': 7, '八': 8, '九': 9, '十': 10,
    '二十': 20, '三十': 30, '四十': 40, '五十': 50,
    '六十': 60, '七十': 70, '八十': 80, '九十': 90
}

def chinese_to_arabic(text: str) -> str:
    """将文本中的中文数字转换为阿拉伯数字"""
    # 实现逻辑
    pass

def convert_ranking_chinese_numbers(query: str) -> str:
    """专门处理排名查询中的中文数字"""
    # 仅在特定模式下转换，避免误替换
    pass
```

### 3. 集成点分析

**方案一：查询预处理阶段（推荐）**
- 在 `HybridAgent` 收到查询后立即处理
- 优点：统一处理，所有Agent都能受益
- 缺点：可能有误替换风险

**方案二：参数提取时处理**
- 修改 `query_templates.py` 的 `extract_params` 方法
- 优点：精确控制，仅在需要时转换
- 缺点：需要修改多处代码

### 4. 测试用例

```python
# 基础转换测试
test_cases = [
    ("前十", "前10"),
    ("前二十", "前20"),
    ("TOP五", "TOP5"),
    ("涨幅前十", "涨幅前10"),
    ("市值前二十名", "市值前20名"),
    ("成交额前五十", "成交额前50"),
]

# 不应转换的情况
negative_cases = [
    "十全十美的股票",  # 成语不转换
    "第一季度",        # 非排名语境
    "一带一路概念",    # 专有名词
]
```

### 5. 风险评估

1. **误替换风险**：可能将非数字语境的中文字符错误转换
2. **性能影响**：每个查询都需要进行模式匹配和替换
3. **维护成本**：需要持续更新和维护转换规则
4. **用户习惯**：可能导致用户过度依赖，不愿使用阿拉伯数字

## 暂缓开发的原因

1. **优先级考虑**：当前有更重要的功能需要开发和优化
2. **投入产出比**：功能开发成本相对较高，但提升有限
3. **系统稳定性**：避免在快速迭代期引入新的复杂性
4. **用户教育**：可以通过提示引导用户使用阿拉伯数字

## 替代方案

1. **用户提示**：在界面上提示用户使用阿拉伯数字
2. **示例引导**：提供查询示例，展示正确的数字格式
3. **错误提示优化**：当检测到中文数字时，友好提示用户使用阿拉伯数字

## 未来实施建议

如果未来决定实施此功能，建议：

1. **分阶段实施**：先支持基础的"前十"、"前二十"等常用表达
2. **A/B测试**：在部分用户中测试功能效果
3. **性能监控**：确保不影响查询响应速度
4. **可配置化**：提供开关，允许禁用此功能

## 相关文档

- 原始需求来源：SQL Agent快速模板测试反馈
- 相关讨论：2025-01-03 开发会议记录