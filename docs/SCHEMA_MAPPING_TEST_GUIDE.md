# æ•°æ®åº“Schemaä¸­æ–‡æ˜ å°„ç³»ç»Ÿæµ‹è¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å¸®åŠ©ä½ å…¨é¢æµ‹è¯•æ•°æ®åº“Schemaä¸­æ–‡æ˜ å°„ç³»ç»Ÿï¼Œç¡®ä¿ç³»ç»Ÿæ­£å¸¸å·¥ä½œã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# Windowsç¯å¢ƒ
cd E:\PycharmProjects\stock_analysis_system
venv\Scripts\activate

# WSL2ç¯å¢ƒ
cd /mnt/e/PycharmProjects/stock_analysis_system
source venv/bin/activate
```

### 2. å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆçº¦30ç§’ï¼‰
python test_schema_mapping_guide.py --quick
```

é¢„æœŸè¾“å‡ºï¼š
```
Schemaæ˜ å°„ç³»ç»Ÿ - å¿«é€Ÿæµ‹è¯•
================================================================================

1. æµ‹è¯•SchemaåŠ è½½...
âœ… åŠ è½½æˆåŠŸ: 14ä¸ªè¡¨, 535ä¸ªå­—æ®µ

2. æµ‹è¯•å­—æ®µæ˜ å°„...
âœ… è‚¡ç¥¨ä»£ç  -> ts_code
âœ… æ”¶ç›˜ä»· -> close
âœ… æˆäº¤é‡ -> vol

3. æµ‹è¯•æŸ¥è¯¢è§£æ...
âœ… è§£ææˆåŠŸ: ç±»å‹=stock_price, å­—æ®µ=6ä¸ª

4. æµ‹è¯•SQLç”Ÿæˆ...
âœ… SQLç”ŸæˆæˆåŠŸ: SELECT open, high, low, close, vol, amount FROM tu_daily_detail...

å¿«é€Ÿæµ‹è¯•å®Œæˆï¼
```

### 3. å®Œæ•´æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ˆçº¦3-5åˆ†é’Ÿï¼‰
python test_schema_mapping_guide.py
```

é€‰æ‹©é€‰é¡¹1è¿è¡Œå®Œæ•´æµ‹è¯•ã€‚

## ğŸ“Š æµ‹è¯•é¡¹ç›®è¯¦è§£

### æµ‹è¯•1: SchemaåŠ è½½å’Œç»Ÿè®¡
- **ç›®çš„**: éªŒè¯ç³»ç»Ÿèƒ½å¦ä»æ•°æ®åº“åŠ¨æ€åŠ è½½è¡¨ç»“æ„
- **æ£€æŸ¥ç‚¹**:
  - è¡¨æ•°é‡åº”ä¸º14ä¸ª
  - å­—æ®µæ€»æ•°åº”è¶…è¿‡500ä¸ª
  - ä¸­æ–‡å­—æ®µååº”è¶…è¿‡400ä¸ª
- **å¸¸è§é—®é¢˜**: å¦‚æœåŠ è½½å¤±è´¥ï¼Œæ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®

### æµ‹è¯•2: ä¸­æ–‡å­—æ®µæ˜ å°„
- **ç›®çš„**: éªŒè¯å¸¸ç”¨ä¸­æ–‡å­—æ®µåèƒ½æ­£ç¡®æ˜ å°„åˆ°è‹±æ–‡
- **æµ‹è¯•å­—æ®µ**:
  - è‚¡ç¥¨ä»£ç  â†’ ts_code
  - æ”¶ç›˜ä»· â†’ close
  - æˆäº¤é‡ â†’ vol
  - å‡€åˆ©æ¶¦ â†’ n_income
  - æ€»èµ„äº§ â†’ total_assets
- **é€šè¿‡æ ‡å‡†**: 80%ä»¥ä¸Šæ˜ å°„æ­£ç¡®

### æµ‹è¯•3: ä¸­æ–‡è¡¨åæ˜ å°„
- **ç›®çš„**: éªŒè¯ä¸­æ–‡è¡¨åèƒ½æ­£ç¡®æ˜ å°„
- **æµ‹è¯•è¡¨å**:
  - æ—¥çº¿è¡Œæƒ… â†’ tu_daily_detail
  - åˆ©æ¶¦è¡¨ â†’ tu_income
  - èµ„äº§è´Ÿå€ºè¡¨ â†’ tu_balancesheet
- **é€šè¿‡æ ‡å‡†**: 70%ä»¥ä¸Šæ˜ å°„æ­£ç¡®

### æµ‹è¯•4: ä¸­æ–‡æŸ¥è¯¢è§£æ
- **ç›®çš„**: éªŒè¯è‡ªç„¶è¯­è¨€æŸ¥è¯¢çš„ç†è§£èƒ½åŠ›
- **æµ‹è¯•æŸ¥è¯¢**:
  - "æŸ¥è¯¢è´µå·èŒ…å°æœ€æ–°è‚¡ä»·"
  - "èŒ…å°æœ€è¿‘30å¤©çš„æ”¶ç›˜ä»·å’Œæˆäº¤é‡"
  - "åˆ†æå¹³å®‰é“¶è¡Œçš„è´¢åŠ¡çŠ¶å†µ"
- **æ£€æŸ¥å†…å®¹**: æŸ¥è¯¢ç±»å‹ã€å­—æ®µã€è‚¡ç¥¨ä»£ç ã€æ—¶é—´æ¡ä»¶

### æµ‹è¯•5: SQLç”Ÿæˆ
- **ç›®çš„**: éªŒè¯èƒ½å¦ç”Ÿæˆæ­£ç¡®çš„SQLè¯­å¥
- **æ£€æŸ¥ç‚¹**: SQLåŒ…å«å¿…è¦çš„å…³é”®è¯ï¼ˆSELECTã€FROMã€WHEREç­‰ï¼‰

### æµ‹è¯•6: Hybrid Agenté›†æˆ
- **ç›®çš„**: éªŒè¯ä¸ä¸»æŸ¥è¯¢ç³»ç»Ÿçš„é›†æˆ
- **æ³¨æ„**: éœ€è¦åˆå§‹åŒ–æ‰€æœ‰Agentï¼Œè€—æ—¶è¾ƒé•¿ï¼ˆ30ç§’+ï¼‰

## ğŸ” æ‰‹åŠ¨æµ‹è¯•æ–¹æ³•

### 1. Pythonäº¤äº’å¼æµ‹è¯•

```python
# å¯åŠ¨Pythonäº¤äº’ç¯å¢ƒ
python

# æµ‹è¯•SchemaåŠ è½½
from utils.schema_cache_manager import SchemaCacheManager
manager = SchemaCacheManager()
stats = manager.get_stats()
print(f"è¡¨æ•°é‡: {stats['table_count']}")
print(f"å­—æ®µæ•°: {stats['field_count']}")

# æµ‹è¯•å­—æ®µæ˜ å°„
field_info = manager.get_field_by_chinese("æ”¶ç›˜ä»·")
print(f"æ”¶ç›˜ä»· -> {field_info['table']}.{field_info['field']}")

# æµ‹è¯•æŸ¥è¯¢è§£æ
from utils.chinese_query_parser import ChineseQueryParser
parser = ChineseQueryParser()
result = parser.parse_query("æŸ¥è¯¢èŒ…å°æœ€æ–°è‚¡ä»·")
print(result)

# ç”ŸæˆSQL
sql = parser.generate_sql(result)
print(sql)
```

### 2. APIæµ‹è¯•

```bash
# å¯åŠ¨APIæœåŠ¡
python -m uvicorn api.main:app --reload --host 0.0.0.0 --port 8000

# æµ‹è¯•æŸ¥è¯¢ï¼ˆæ–°ç»ˆç«¯ï¼‰
curl -X POST http://localhost:8000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "question": "æŸ¥è¯¢è´µå·èŒ…å°æœ€æ–°è‚¡ä»·",
    "query_type": "hybrid"
  }'
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: SchemaåŠ è½½å¤±è´¥
- **ç—‡çŠ¶**: è¡¨æ•°é‡ä¸º0æˆ–æŠ¥é”™
- **è§£å†³æ–¹æ¡ˆ**:
  1. æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼š`python scripts/tests/test_databases.py`
  2. ç¡®è®¤.envæ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ­£ç¡®
  3. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### é—®é¢˜2: ä¸­æ–‡æ˜ å°„ä¸å‡†ç¡®
- **ç—‡çŠ¶**: å­—æ®µæ˜ å°„åˆ°é”™è¯¯çš„è‹±æ–‡å
- **åŸå› **: æ•°æ®åº“å­—æ®µæ³¨é‡Šå¯èƒ½ä¸æ ‡å‡†
- **è§£å†³æ–¹æ¡ˆ**:
  1. æŸ¥çœ‹å…·ä½“å­—æ®µçš„æ³¨é‡Šï¼š
     ```sql
     SELECT COLUMN_NAME, COLUMN_COMMENT 
     FROM INFORMATION_SCHEMA.COLUMNS 
     WHERE TABLE_SCHEMA = 'Tushare' 
       AND TABLE_NAME = 'tu_daily_detail';
     ```
  2. æ‰‹åŠ¨è°ƒæ•´è§£æè§„åˆ™

### é—®é¢˜3: æŸ¥è¯¢è§£æå¤±è´¥
- **ç—‡çŠ¶**: æ— æ³•è¯†åˆ«æŸ¥è¯¢ç±»å‹æˆ–æå–ä¿¡æ¯
- **è§£å†³æ–¹æ¡ˆ**:
  1. æ£€æŸ¥æŸ¥è¯¢è¯­å¥æ˜¯å¦åŒ…å«å…³é”®è¯
  2. æŸ¥çœ‹è§£ææ—¥å¿—äº†è§£åŒ¹é…è¿‡ç¨‹
  3. å¿…è¦æ—¶æ·»åŠ æ–°çš„æŸ¥è¯¢æ¨¡å¼

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

æ­£å¸¸æƒ…å†µä¸‹çš„æ€§èƒ½æŒ‡æ ‡ï¼š

| æ“ä½œ | é¢„æœŸæ—¶é—´ |
|------|---------|
| SchemaåŠ è½½ | < 1ç§’ |
| å­—æ®µæ˜ å°„æŸ¥è¯¢ | < 10ms |
| æŸ¥è¯¢è§£æ | < 50ms |
| SQLç”Ÿæˆ | < 20ms |
| ç«¯åˆ°ç«¯æŸ¥è¯¢ | < 100ms |

## ğŸ”„ æŒç»­æµ‹è¯•

å»ºè®®åœ¨ä»¥ä¸‹æƒ…å†µè¿è¡Œæµ‹è¯•ï¼š
1. æ•°æ®åº“è¡¨ç»“æ„å˜æ›´å
2. æ›´æ–°æ˜ å°„è§„åˆ™å
3. æ¯æ—¥ä¾‹è¡Œæ£€æŸ¥ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰
4. ç‰ˆæœ¬å‘å¸ƒå‰ï¼ˆå®Œæ•´æµ‹è¯•ï¼‰

## ğŸ“ æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåï¼Œè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
- æµ‹è¯•æ—¥æœŸå’Œæ—¶é—´
- æµ‹è¯•ç¯å¢ƒï¼ˆWindows/WSL2ï¼‰
- é€šè¿‡/å¤±è´¥çš„æµ‹è¯•é¡¹
- å‘ç°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- æ€§èƒ½æŒ‡æ ‡

## ğŸ¤ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`logs/`ç›®å½•
2. è¿è¡Œç³»ç»Ÿæ£€æŸ¥ï¼š`python scripts/utils/system_check.py`
3. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼š`docs/`ç›®å½•
4. æäº¤Issueåˆ°GitHubä»“åº“