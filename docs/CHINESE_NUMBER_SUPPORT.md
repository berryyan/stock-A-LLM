# 中文数字支持功能文档

## 功能概述

从 v2.2.0 版本开始，股票分析系统的 SQL Agent 支持中文数字表达，用户可以使用更自然的中文表达方式进行查询。

## 支持的中文数字表达

### 1. 基本数字
- 一、二、三、四、五、六、七、八、九、十
- 十一 ~ 九十九
- 一百、两百、三百...九百
- 一千、两千...九千
- 一万

### 2. 常用查询格式

#### "前N"格式
- 前十 → 前10
- 前二十 → 前20
- 前五十 → 前50
- 前一百 → 前100

#### "TOP N"格式
- TOP十 → TOP10
- TOP二十 → TOP20
- top五 → top5（大小写不敏感）

#### 其他格式
- 第三 → 第3
- 十名 → 10名
- 二十个 → 20个
- 三十只 → 30只

## 实际查询示例

### 涨跌幅排名
```
用户输入：涨幅前十
系统转换：涨幅前10
```

```
用户输入：跌幅前二十的股票
系统转换：跌幅前20的股票
```

### 市值排名
```
用户输入：市值排名前五十
系统转换：市值排名前50
```

```
用户输入：流通市值TOP二十
系统转换：流通市值TOP20
```

### 成交额/成交量
```
用户输入：成交额前十五
系统转换：成交额前15
```

### 财务指标
```
用户输入：PE最高前三十
系统转换：PE最高前30
```

```
用户输入：净利润排名前一百
系统转换：净利润排名前100
```

### 资金流向
```
用户输入：主力净流入前二十
系统转换：主力净流入前20
```

## 技术实现

### 核心组件
- `utils/chinese_number_converter.py` - 中文数字转换工具
- `agents/sql_agent.py` - 集成中文数字支持

### 处理流程
1. 用户输入查询
2. 日期智能解析
3. **中文数字规范化**（新增步骤）
4. 模板匹配
5. 参数提取（优先使用中文数字提取）
6. 执行查询

### 性能影响
- 中文数字转换耗时：< 1ms
- 对整体查询性能无明显影响

## 兼容性

- ✅ 完全向后兼容
- ✅ 阿拉伯数字查询不受影响
- ✅ 同时支持中文和阿拉伯数字

## 默认值处理

当查询中包含排名相关关键词但未指定数量时，系统默认返回前10条记录：
- "涨幅排名" → 默认前10
- "市值排行" → 默认前10
- "主力净流入排行" → 默认前10

## 注意事项

1. 目前支持的最大中文数字为"一万"（10000）
2. 不支持复杂的中文数字表达（如"两万三千四百五十六"）
3. 混合使用时以第一个识别到的数字为准

## 测试验证

所有中文数字转换功能都经过了完整的单元测试：
- 基本转换测试：16/16 通过
- 查询提取测试：17/17 通过
- 规范化测试：9/9 通过
- **总体测试通过率：100%**