# 流式响应功能测试检查清单

## 测试前准备

### 环境检查
- [ ] 确认Node.js版本 >= 18
- [ ] 确认后端API服务正在运行（端口8000）
- [ ] 确认前端开发服务器正在运行（端口5173）
- [ ] 浏览器开发者工具已打开

### 测试数据准备
```javascript
// 测试查询列表
const testQueries = [
    "茅台最新股价",                          // 简单SQL查询
    "贵州茅台最新公告",                      // RAG查询
    "分析贵州茅台的财务健康度",              // 财务分析查询
    "茅台最近的资金流向如何",                // 资金流向查询
    "详细分析平安银行近三个月的技术走势和主力资金动向", // 长文本查询
];
```

## 功能测试步骤

### 1. WebSocket连接测试

#### 步骤1.1：初始连接
1. 打开应用 http://localhost:5173
2. 打开浏览器控制台（F12）
3. 检查Network标签中的WS连接
4. 验证点：
   - [ ] 看到 ws://localhost:8000/ws 连接
   - [ ] 连接状态为 101 Switching Protocols
   - [ ] 收到欢迎消息

#### 步骤1.2：连接失败测试
1. 停止后端服务
2. 刷新前端页面
3. 发送一个查询
4. 验证点：
   - [ ] 控制台显示连接失败信息
   - [ ] 查询通过HTTP POST发送
   - [ ] 功能正常工作

### 2. 流式显示测试

#### 步骤2.1：基本流式效果
1. 发送查询："茅台最新股价"
2. 观察响应显示过程
3. 验证点：
   - [ ] 文字逐个出现（非一次性显示）
   - [ ] 显示速度均匀
   - [ ] 无明显卡顿

#### 步骤2.2：打字光标测试
1. 在响应显示过程中观察
2. 验证点：
   - [ ] 光标在文字末尾闪烁
   - [ ] 光标位置随文字增长移动
   - [ ] 显示完成后光标消失

#### 步骤2.3：长文本测试
1. 发送复杂查询："详细分析贵州茅台的财务状况，包括盈利能力、偿债能力、运营效率和成长潜力"
2. 验证点：
   - [ ] 长文本流畅显示
   - [ ] 换行正确处理
   - [ ] Markdown格式正确渲染

### 3. 中断功能测试

#### 步骤3.1：取消按钮测试
1. 发送一个查询
2. 在响应过程中观察界面
3. 验证点：
   - [ ] 取消按钮出现在输入框右侧
   - [ ] 按钮为红色样式
   - [ ] 鼠标悬停有交互效果

#### 步骤3.2：中断操作测试
1. 发送长查询："分析A股市场所有银行股的财务健康度并排名"
2. 在显示过程中点击取消按钮
3. 验证点：
   - [ ] 流式显示立即停止
   - [ ] 显示"(查询已中断)"提示
   - [ ] 可以立即发送新查询

### 4. 边界情况测试

#### 步骤4.1：快速连续查询
1. 快速发送3-4个不同查询
2. 验证点：
   - [ ] 只显示最后一个查询结果
   - [ ] 无错误或异常
   - [ ] 界面响应正常

#### 步骤4.2：空查询测试
1. 不输入内容直接发送
2. 验证点：
   - [ ] 无法发送（按钮禁用或无响应）
   - [ ] 无错误提示

#### 步骤4.3：特殊字符测试
1. 发送包含特殊字符的查询："<script>alert('test')</script>"
2. 验证点：
   - [ ] 特殊字符正确转义
   - [ ] 无XSS漏洞
   - [ ] 显示正常

### 5. 性能测试

#### 步骤5.1：内存监控
1. 打开Chrome DevTools -> Memory
2. 记录初始内存使用
3. 发送10个查询
4. 验证点：
   - [ ] 内存增长合理（<50MB）
   - [ ] 无明显内存泄漏
   - [ ] GC正常工作

#### 步骤5.2：CPU监控
1. 打开Chrome DevTools -> Performance
2. 开始录制
3. 发送查询并观察
4. 验证点：
   - [ ] CPU使用率合理（<30%）
   - [ ] 无长时间阻塞主线程
   - [ ] 动画帧率稳定（>30fps）

## 兼容性测试

### 浏览器兼容性
- [ ] Chrome 最新版
- [ ] Edge 最新版
- [ ] Firefox 最新版
- [ ] Safari（如可用）

### 响应式测试
- [ ] 桌面端（1920x1080）
- [ ] 平板端（768x1024）
- [ ] 移动端（375x667）

## 问题记录模板

```markdown
### 问题 #1
**描述**: 
**重现步骤**: 
1. 
2. 
3. 
**预期结果**: 
**实际结果**: 
**严重程度**: 高/中/低
**截图/录屏**: 
```

## 测试完成标准

- [ ] 所有测试用例通过
- [ ] 无阻塞性问题
- [ ] 性能指标达标
- [ ] 用户体验流畅
- [ ] 错误处理完善

## 测试工具

1. **WebSocket测试工具**: test_websocket.html
2. **Chrome DevTools**: 
   - Network标签查看WebSocket
   - Console标签查看日志
   - Performance标签监控性能
   - Memory标签检查内存
3. **录屏工具**: Windows自带录屏（Win+G）

---
最后更新：2025-06-27