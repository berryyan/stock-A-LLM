# 股票分析系统综合测试指南 v5.2

**更新日期**: 2025-07-04  
**文档说明**: SQL Agent测试部分全面重构，确保18个模板都有完整的边界和错误测试

> 📝 **v5.2 更新内容**:
> - 修正SQL Agent模板数量为18个（原错误标注为10个）
> - 为每个模板添加完整的边界测试和错误测试
> - 特别强化v2.1.17提取功能相关的测试用例
> - 增加中文数字、日期范围、股票名称清理等边界测试

## SQL Agent测试

### 一、已实现的快速模板（18个）

> 📌 **版本说明**: 
> - **v2.1.17**: 日期范围连接符扩展、月份/年份转换、股票名称智能清理
> - **v2.1.13-14**: 公告查询功能实现
> - **v2.1.11**: 财务指标排名模板（PE/PB/ROE等5个）
> - **v2.1.8**: 市值排名模板支持无数字默认前10

### 模板1：股价查询模板

```
✅ 正常用例：
- 贵州茅台最新股价
- 贵州茅台20250627的股价
- 平安银行昨天的股价
- 600519.SH最新股价
- 贵州茅台2025-06-27的股价
- 000001.SZ的股价

🔧 边界测试：
日期格式测试：
- 贵州茅台2025年06月27日的股价（中文日期格式）
- 贵州茅台2025/6/27的股价（斜杠格式）
- 贵州茅台20250627的股价（紧凑格式）

股票代码格式测试：
- 600519最新股价（无后缀.SH）
- 600519.sh最新股价（小写后缀）
- 600519.SH最新股价（标准格式）

相对日期测试：
- 贵州茅台前天的股价
- 贵州茅台上个交易日的股价
- 贵州茅台最近一个交易日的股价

❌ 错误用例：
- 茅台最新股价（应提示：请使用完整公司名称，如：贵州茅台）
- 平安最新股价（应提示：存在多个匹配，请使用完整名称）
- 123456最新股价（不存在的股票代码）
- 贵州茅台2025-06-31的股价（无效日期）
- 空字符串查询（应返回错误）
- 贵州茅台2099年的股价（超出数据范围）

预期结果：
- 快速路径：<0.1秒
- 返回完整行情数据（开高低收、成交量、成交额、涨跌幅）
- 错误提示准确具体
```

### 模板2：成交量查询模板

```
✅ 正常用例：
成交量查询：
- 平安银行昨天的成交量
- 贵州茅台最新成交量
- 万科A的成交量
- 600519.SH今天的成交量

成交额查询：
- 中国平安的成交额
- 宁德时代昨天的成交额
- 比亚迪最新成交额
- 000001.SZ的成交额

时间指定：
- 贵州茅台2025-07-01的成交量
- 平安银行最近的成交额
- 万科A前天的成交量

🔧 边界测试：
股票名称清理测试（v2.1.17重点）：
- 万科A前天的成交量（测试"A前天"不被误解为一个整体）
- 中国平安昨天的成交额（测试"平安昨天"不被误解）
- 贵州茅台最近5天的成交量（测试日期替换后的股票提取）
- 宁德时代今天的成交额（测试"今天"替换）
- 比亚迪上个交易日的成交量

日期格式测试：
- 贵州茅台2025年6月27日的成交量
- 平安银行2025/06/27的成交额
- 万科A20250627的成交量

股票格式测试：
- 600519的成交量（无后缀）
- 000001.sz的成交额（小写后缀）

❌ 错误用例：
路由冲突测试：
- 成交量排名（应路由到排名模板，不应匹配此模板）
- 成交额排行（应路由到排名模板）
- 成交量TOP10（应路由到排名模板）

股票错误：
- 茅台的成交量（简称错误）
- 不存在股票的成交量
- 123456.SH的成交额（无效代码）

日期错误：
- 贵州茅台2099年的成交量（未来日期）
- 平安银行2025-13-01的成交额（无效月份）

预期结果：
- 返回成交量（万手）和成交额（亿元）
- 同时显示股价和涨跌幅
- 股票名称提取准确（不受日期替换影响）
- 路由判断准确（区分查询和排名）
```

### 模板3：估值指标查询模板（PE/PB）

```
✅ 正常用例：
PE查询：
- 中国平安的市盈率
- 贵州茅台的PE
- 平安银行的PE值
- 600519.SH的市盈率

PB查询：
- 平安银行的市净率
- 比亚迪的PB
- 万科A的PB值
- 000002.SZ的市净率

🔧 边界测试：
股票格式测试：
- 600519的PE（无后缀）
- 000001.sz的PB（小写后缀）
- 贵州茅台的市盈率（全称）

指标别名测试：
- 中国平安的PE比率
- 平安银行的PB比率
- 贵州茅台的估值指标

❌ 错误用例：
- 茅台的PE（简称错误）
- PE排名（应路由到排名模板）
- 市盈率最低的股票（应路由到排名模板）
- 不存在股票的PB
- 空查询

预期结果：
- 返回PE、PE_TTM、PB、PS、PC等完整估值指标
- 数据来源：tu_daily_basic表
- 支持多种指标名称别名
```

### 模板4：K线查询模板

```
✅ 正常用例：
基础K线查询：
- 中国平安最近10天的K线（返回10天）
- 贵州茅台最近30天的走势
- 万科A的K线（默认90天）

日期范围查询：
- 宁德时代从2025/06/01到2025/06/30的K线
- 宁德时代从6月1日到6月30日的K线

🔧 边界测试（v2.1.17新增）：
日期范围连接符测试：
- 贵州茅台2025-06-01至2025-06-30的K线（"至"）
- 万科A2025-06-01到2025-06-30的K线（"到"）
- 中国平安2025-06-01-2025-06-30的K线（"-"）
- 比亚迪2025/6/1~2025/6/30的K线（"~"）
- 宁德时代2025.6.1-2025.6.30的走势（混合格式）

月份/年份转换测试：
- 万科A6月的K线（→2025-06-01至2025-06-30）
- 中国平安2024年的K线（→2024-01-01至2024-12-31）
- 宁德时代2025年第二季度的走势（→2025-04-01至2025-06-30）
- 贵州茅台本月的K线（相对月份）
- 平安银行上个月的K线
- 比亚迪去年的K线
- 万科A今年第一季度的K线
- 中国平安去年第四季度的走势

中文数字测试：
- 贵州茅台最近二十天的K线
- 中国平安前十天的走势
- 万科A最近一百天的K线
- 比亚迪近三十个交易日的行情
- 宁德时代前五个交易日的走势

股票名称清理测试：
- 万科A最近5天的K线（测试"A最近"不被误解）
- 中国平安6月的走势（测试"平安6月"不被误解）

❌ 错误用例：
基础错误：
- K线（无股票名称）
- 茅台的K线（简称）
- 不存在股票的K线

日期错误：
- 贵州茅台13月的K线（无效月份）
- 中国平安2025年第五季度的K线（无效季度）
- 万科A2025-06-31的K线（无效日期）
- 贵州茅台明年的K线（未来时间）

格式错误：
- 贵州茅台最近天的K线（缺少数字）
- 中国平安前零天的走势（无效数字）

预期结果：
- 支持多种日期格式和连接符
- 自动转换月份/年份为日期范围
- 返回structured_data用于图表展示
- 中文数字正确识别并转换
- 包含开高低收、成交量、成交额、涨跌幅等完整数据
```

### 模板5：涨跌幅排名模板

```
✅ 正常用例：
涨幅排名：
- 今天涨幅最大的前10只股票
- 涨幅前20
- 20250627涨幅前10
- 涨幅排名（默认前10）

跌幅排名：
- 今日跌幅最大的前10只股票
- 跌幅前15
- 跌幅排名
- 跌幅最大的股票

🔧 边界测试：
中文数字测试：
- 涨幅前二十
- 跌幅最大的前五只股票
- 涨幅前一百名
- 跌幅前三十

日期测试：
- 昨天涨幅排名
- 2025-06-27跌幅排名
- 上个交易日涨幅前10
- 前天跌幅最大的股票

排除条件测试：
- 涨幅前10排除ST
- 跌幅排名排除*ST
- 涨幅前20排除北交所

❌ 错误用例：
- 贵州茅台涨幅排名（个股不应有排名）
- 涨幅前0只股票（无效数量）
- 涨幅前1000只股票（数量过大）
- 涨跌幅排名（歧义表达）

预期结果：
- 快速返回排名表格
- 不触发股票验证
- 支持中文数字识别
- 默认返回前10（未指定数量时）
- 支持排除ST/*ST股票
```

### 模板6：市值排名模板

```
✅ 正常用例：
传统格式：
- 总市值最大的前20只股票
- 流通市值最大的前10只股票
- 市值排名前50
- 市值前20名

无数字默认前10：
- 总市值排名
- 市值排名
- 流通市值排名
- 市值排行

TOP格式：
- 市值TOP10
- 市值TOP20
- 总市值TOP50
- 流通市值TOP30

🔧 边界测试：
中文数字测试：
- 市值前二十
- 总市值前五十
- 流通市值前一百

排除条件测试：
- 市值排名排除ST
- 总市值前10排除北交所
- 流通市值排名排除*ST

最高/最低测试：
- 市值最高的股票
- 流通市值最低的10只股票
- 总市值最大的公司

❌ 错误用例：
- 贵州茅台的市值排名（个股查询）
- 市值前0只股票（无效数量）
- 市值TOP1000（数量过大）
- 昨天的市值排名（市值是实时数据）

预期结果：
- 分别显示总市值和流通市值（亿元）
- Markdown表格格式
- 无数字时默认返回前10条
- 支持中文数字和TOP格式
```

### 模板7：成交额排名模板

```
✅ 正常用例：
基础排名：
- 成交额最大的前10只股票
- 成交额排名前20
- 成交额前15

无数字默认：
- 成交额排名
- 成交额排行
- A股成交额排名

TOP格式：
- 成交额TOP10
- 成交额TOP20

时间指定：
- 今天的成交额排名
- 昨天成交额排名前10
- 2025-07-01成交额排名

🔧 边界测试：
中文数字：
- 成交额前二十
- 成交额前五十名
- 成交额最大的三十只股票

排除条件：
- 成交额排名排除ST
- 成交额前10排除创业板
- 成交额TOP20排除北交所

❌ 错误用例：
- 贵州茅台的成交额排名（个股查询）
- 成交额前-10（负数）
- 成交额排名1000（过大）

预期结果：
- 成交额以亿元为单位
- 包含股价和涨跌幅信息
- 支持时间指定
```

### 模板8：成交量排名模板

```
✅ 正常用例：
基础排名：
- 成交量最大的前10只股票
- 成交量排名前20
- 成交量前15

与成交量查询的区分：
- "贵州茅台的成交量" → 成交量查询（个股）
- "成交量排名" → 成交量排名（排行）

🔧 边界测试：
路由测试（重要）：
- 成交量TOP10（排名）
- 万科A的成交量（个股）
- 昨天成交量排名（排名）
- 600519的成交量（个股）

中文数字：
- 成交量前三十
- 成交量最大的五十只

❌ 错误用例：
- 成交量排名前0
- 个股+成交量排名（路由冲突）

预期结果：
- 成交量以万手为单位
- 正确区分个股查询与排名查询
- 支持各种表达方式
```

### 模板9：主力净流入/流出排名模板

```
✅ 正常用例：
流入排名：
- 主力净流入前10
- 主力资金流入排名
- 昨天主力净流入前20

流出排名：
- 主力净流出前10
- 主力资金流出排名
- 今天主力净流出前15

超大单排名：
- 超大单净流入前10
- 超大单资金流入排名

🔧 边界测试：
资金类型测试：
- 大单净流入排名
- 中单净流出排名
- 小单净流入前10

时间测试：
- 最近5天主力净流入
- 本周主力资金流入排名
- 上个月主力净流出

❌ 错误用例：
非标准术语：
- 机构资金流入排名（应提示使用：主力资金）
- 大资金流入排行（应提示使用：主力资金）
- 游资净流入排名（不支持）

预期结果：
- 净流入金额（万元）和占比
- 流出排名按升序排列
- 非标准术语给出明确提示
```

### 模板10：个股主力资金查询模板

```
✅ 正常用例：
基础查询：
- 贵州茅台的主力资金
- 万科A主力资金流向
- 600519的主力资金

时间指定：
- 贵州茅台昨天的主力资金
- 万科A前天的主力资金

资金类型：
- 贵州茅台的超大单资金
- 万科A的中单资金

🔧 边界测试：
股票名称清理（v2.1.17）：
- 万科A昨天的主力资金（测试"A昨天"）
- 中国平安前天的主力资金
- 贵州茅台最近的主力资金

股票格式：
- 600519.SH的主力资金
- 600519主力资金
- 000001.sz的主力资金

❌ 错误用例：
术语错误：
- 贵州茅台的游资资金（应提示使用标准术语）
- 万科A的机构资金（应提示使用：主力资金）

股票错误：
- 茅台的主力资金（简称）
- 不存在股票的主力资金

预期结果：
- 返回单行数据
- 包含主力、超大单、大单、中单、小单资金
- 净流入为正，净流出为负
- 单位：万元
```

### 模板11：板块主力资金查询模板

```
✅ 正常用例：
- 银行板块的主力资金
- 新能源板块主力资金流向
- 白酒板块的主力资金
- 半导体板块主力净流入

🔧 边界测试：
板块名称：
- 银行板块主力资金（必须包含"板块"）
- 银行的主力资金（错误：缺少"板块"）

时间指定：
- 银行板块昨天的主力资金
- 新能源板块今天的主力资金

❌ 错误用例：
- 银行主力资金（缺少"板块"后缀）
- 不存在板块的主力资金
- 板块的主力资金（无具体板块名）

预期结果：
- 返回板块内股票的资金排名
- 显示个股资金流向
- 按净流入降序排列
```

### 模板12：利润查询模板

```
✅ 正常用例：
基础查询：
- 贵州茅台的利润
- 平安银行的净利润
- 万科A的利润情况

报告期指定：
- 贵州茅台2025年一季度利润
- 平安银行2024年年报利润
- 万科A最新利润

🔧 边界测试：
报告期格式：
- 贵州茅台2025Q1利润
- 平安银行2024年报利润
- 万科A一季报利润

股票格式：
- 600519的利润
- 000001.SZ的净利润

❌ 错误用例：
- 利润排名（应路由到排名模板）
- 茅台的利润（简称）
- 利润最高的股票（排名查询）

预期结果：
- 返回净利润数据（亿元）
- 显示报告期
- 支持报告期查询
```

### 模板13-17：财务排名模板（PE/PB/净利润/营收/ROE）

```
✅ PE排名正常用例：
- PE最低的前10只股票
- 市盈率排名
- PE排行前20

✅ PB排名正常用例：
- PB最低的前10只股票
- 市净率排名
- PB排行

✅ 净利润排名正常用例：
- 净利润最高的前10只股票
- 利润排名
- 净利润TOP20

✅ 营收排名正常用例：
- 营业收入最高的前10只股票
- 营收排名
- 收入排行前20

✅ ROE排名正常用例：
- ROE最高的前10只股票
- 净资产收益率排名
- ROE排行

🔧 通用边界测试：
中文数字：
- PE最低的前二十
- 净利润前五十
- ROE最高的三十只

排除条件：
- PE排名排除亏损
- PB排名排除负值
- 净利润排名排除ST

最高/最低：
- PE最低的股票
- ROE最高的公司
- 净利润最多的企业

❌ 通用错误用例：
- 贵州茅台的PE排名（个股查询）
- 排名前0（无效数量）
- 未来报告期排名

预期结果：
- 快速返回（1-2秒）
- 自动过滤异常值
- 最新报告期数据
```

### 模板18：公告查询模板

```
✅ 正常用例：
最新公告：
- 贵州茅台的最新公告
- 平安银行最近的公告
- 万科A的公告

日期指定：
- 贵州茅台2025-07-01的公告
- 平安银行昨天的公告

日期范围：
- 贵州茅台本月的公告
- 平安银行最近一周的公告
- 万科A2025-06-01至2025-06-30的公告

🔧 边界测试（v2.1.14）：
日期范围连接符：
- 贵州茅台2025-06-01到2025-06-30的公告
- 万科A2025/6/1至2025/6/30的公告
- 中国平安2025-06-01-2025-06-30的公告

相对时间：
- 贵州茅台本周的公告
- 平安银行上个月的公告
- 万科A今年的公告

❌ 错误用例：
- 公告（无股票）
- 茅台的公告（简称）
- 未来日期的公告

预期结果：
- 返回公告列表（标题、日期、链接）
- 按日期降序排列
- 支持灵活的日期表达
```

## 测试执行建议

1. **批量测试脚本**：建议创建自动化测试脚本，批量执行所有测试用例
2. **性能监控**：记录每个模板的响应时间，确保快速路径性能达标
3. **错误日志**：收集所有错误用例的返回信息，验证错误提示的准确性
4. **回归测试**：每次更新后执行全量测试，确保无功能退化

## 特别关注点（v2.1.17）

1. **日期范围连接符**：测试"-"、"~"等新增连接符
2. **月份/年份转换**：验证自动转换的准确性
3. **股票名称清理**：确保日期替换不影响股票名称提取
4. **中文数字支持**：验证所有涉及数量的查询
5. **路由准确性**：确保查询正确匹配到对应模板