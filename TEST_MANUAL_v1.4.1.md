# 股票分析系统 v1.4.1 完整测试手册

**版本**: v1.4.1  
**更新日期**: 2025-06-23  
**测试环境**: Windows/Linux + Python 3.10 + MySQL + Milvus  

## 📋 测试准备

### 1. 启动服务
```bash
# 激活虚拟环境
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# 启动API服务器
python -m uvicorn api.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. 访问前端
- 浏览器访问: http://localhost:8000/
- API文档: http://localhost:8000/docs

### 3. 测试原则
- ✅ 功能正常：返回预期结果
- ⚠️ 部分正常：功能可用但有瑕疵
- ❌ 功能异常：无法使用或错误

---

## 🧪 模块测试清单

### 一、基础查询功能

#### 1.1 SQL数据查询模块
**功能说明**: 查询结构化数据，包括股价、市值、财务指标、排名等

**数据来源**: 
- tu_daily_detail (日线行情)
- tu_daily_basic (基本面指标)
- tu_stock_basic (股票基本信息)

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 最新股价查询 | "贵州茅台最新股价" | 返回最近交易日的开高低收价格 | 包含4个价格数据 |
| 历史股价查询 | "茅台2025年6月10日的股价" | 返回指定日期的价格数据 | 日期匹配，数据完整 |
| 涨跌幅查询 | "今天涨幅最大的10只股票" | 返回涨幅排名前10的股票列表 | 包含股票代码、名称、涨幅 |
| 市值查询 | "A股市值前5的公司" | 返回市值排名前5的公司 | 包含公司名称、市值数据 |
| 财务数据查询 | "贵州茅台的营业收入" | 返回最新的营业收入数据 | 包含具体金额和报告期 |
| 技术指标查询 | "茅台的市盈率" | 返回PE、PB等估值指标 | 包含具体数值 |

**预期响应格式**:
```
贵州茅台（600519.SH）在2025年6月20日的股价为：
- 开盘价：1423.58元
- 最高价：1441.14元
- 最低价：1420.20元
- 收盘价：1428.66元
- 涨跌幅：+0.19%
- 成交量：XXX手
```

#### 1.2 RAG文档查询模块
**功能说明**: 语义搜索公告、年报、研报等文档内容

**数据来源**: 
- Milvus向量数据库 (120万+文档向量)
- PDF公告文档

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 年报查询 | "贵州茅台最新年报的主要内容" | 返回年报关键信息摘要 | 包含营收、利润等关键数据 |
| 公告查询 | "茅台最近的重要公告" | 返回最近公告的标题和内容 | 包含公告日期、标题、摘要 |
| 业务查询 | "茅台的主营业务是什么" | 返回主营业务描述 | 包含业务板块说明 |
| 风险查询 | "平安银行的经营风险" | 返回风险提示内容 | 包含具体风险点 |
| 战略查询 | "万科的发展战略" | 返回战略规划内容 | 包含战略方向描述 |

**预期响应格式**:
```
根据贵州茅台2024年年度报告：
1. 主要财务数据：
   - 营业收入：XXX亿元，同比增长XX%
   - 净利润：XXX亿元，同比增长XX%
2. 业务亮点：
   - [具体业务描述]
3. 未来展望：
   - [战略规划内容]

信息来源：《贵州茅台2024年年度报告》
```

### 二、智能日期解析功能

#### 2.1 日期智能识别模块
**功能说明**: 自动识别"最新"、"最近"、"现在"等自然语言时间表达

**处理逻辑**:
- "最新"股价 → 最近交易日
- "最新"财报 → 最近报告期
- "最新"公告 → 最近公告日

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 最新股价 | "茅台最新的股价" | 返回最近交易日数据 | 日期为最近交易日 |
| 最近数据 | "贵州茅台最近的表现" | 返回近期综合数据 | 包含近期多项指标 |
| 现在价格 | "600519.SH现在多少钱" | 返回当前/最近价格 | 价格数据时效性 |
| 今天行情 | "今天茅台涨了吗" | 返回今日/最近涨跌 | 涨跌幅数据准确 |

### 三、财务分析功能（Phase 1）

#### 3.1 财务健康度评分
**功能说明**: 基于四个维度进行财务健康度综合评分

**评分维度**:
- 盈利能力 (30%): ROE、净利率、毛利率
- 偿债能力 (25%): 资产负债率、流动比率、速动比率
- 运营能力 (25%): 资产周转率、存货周转率、应收账款周转率
- 成长能力 (20%): 营收增长率、净利润增长率、总资产增长率

**评级标准**:
- AAA级: 90-100分（财务极其健康）
- AA级: 80-89分（财务非常健康）
- A级: 70-79分（财务健康）
- BBB级: 60-69分（财务状况良好）
- BB级: 50-59分（财务状况一般）
- B级: 40-49分（财务状况较差）
- CCC级: 0-39分（财务状况堪忧）

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 优质公司 | "分析贵州茅台的财务健康度" | AA级或以上评分 | 评分>80，四维度清晰 |
| 普通公司 | "分析平安银行的财务健康状况" | A级或BBB级 | 评分合理，分析全面 |
| 问题公司 | "分析ST股票的财务健康度" | B级或以下 | 识别风险，给出警示 |

**预期响应格式**:
```
### 财务健康度分析报告

#### 1. 核心结论
贵州茅台（600519.SH）财务健康度评级：AA级（81分）

#### 2. 维度分析
- 盈利能力：85分（优秀）
  - ROE: 30.5%，远高于行业平均
  - 净利率：51.2%，盈利能力极强
- 偿债能力：100分（极佳）  
  - 资产负债率：23.5%，财务杠杆低
  - 流动比率：3.2，短期偿债无忧
- 运营能力：50分（一般）
  - 总资产周转率：0.58次，资产利用效率有待提升
- 成长能力：90分（优秀）
  - 营收增长率：15.2%，保持稳健增长

#### 3. 投资建议
财务状况优秀，具备长期投资价值...
```

#### 3.2 杜邦分析
**功能说明**: ROE三因素分解分析

**分析公式**: ROE = 净利率 × 总资产周转率 × 权益乘数

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 标准分析 | "对茅台进行杜邦分析" | 完整的ROE分解 | 三因素数据完整 |
| 银行分析 | "平安银行的杜邦分析" | 适合银行业的分析 | 考虑行业特性 |
| 趋势分析 | "茅台的ROE分解趋势" | 多期对比分析 | 展示变化趋势 |

#### 3.3 现金流质量分析
**功能说明**: 评估现金流与净利润的匹配度

**核心指标**:
- 现金含量比率 = 经营现金流 / 净利润
- 评级标准：
  - A级: >1.2（现金流充沛）
  - B级: 0.8-1.2（现金流正常）
  - C级: 0.5-0.8（需要关注）
  - D级: <0.5（现金流紧张）

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 质量分析 | "分析茅台的现金流质量" | 现金含量比率及评级 | 包含具体比率和评级 |
| 趋势分析 | "茅台现金流质量变化" | 多期现金流对比 | 展示趋势变化 |

#### 3.4 多期财务对比
**功能说明**: 对比分析多个报告期的财务数据

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 同比分析 | "茅台最近3年的财务对比" | 年度对比数据 | 包含同比增长率 |
| 环比分析 | "茅台最近4个季度对比" | 季度环比数据 | 包含环比变化 |

### 四、资金流向分析功能（Phase 2）

#### 4.1 主力资金分析（最高优先级）
**功能说明**: 分析主力资金（大单+超大单）的净流入/流出

**数据说明**:
- 主力资金 = 大单(20-100万) + 超大单(≥100万)
- 净流入 = 买入金额 - 卖出金额（根据净额推算）

**评估标准**:
- 流向趋势：持续流入/持续流出/相对平衡
- 流向强度：强势(>5000万)/中等(1000-5000万)/弱势(<1000万)
- 一致性：流向一致天数占比

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 资金流向查询 | "分析贵州茅台的资金流向" | 主力资金净流入数据 | 包含具体金额和趋势 |
| 主力资金查询 | "茅台的主力资金流入情况" | 主力资金详细分析 | 包含流向强度评估 |
| 时间段查询 | "茅台最近7天的资金流向" | 指定期间资金分析 | 时间范围准确 |

**预期响应格式**:
```
### 贵州茅台资金流向分析报告

#### 1. 主力资金流向 ⭐⭐⭐
- 净流入金额：+1.25亿元 (近30日)
- 流向趋势：持续净流入
- 资金强度：强势流入 (评级: A)
- 流向一致性：73%（22天流入，8天流出）

#### 2. 资金流向解读
主力资金持续流入，显示机构看好...
```

#### 4.2 超大单资金分析（重点单独分析）
**功能说明**: 专门分析超大单（≥100万）资金行为

**行为模式识别**:
- 建仓模式：买入占比>65%且净流入为正
- 减仓模式：买入占比<35%且净流出为负
- 洗盘模式：买卖相当，净流向接近0
- 不明模式：其他情况

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 超大单分析 | "茅台的超大单资金如何" | 超大单详细数据 | 包含行为模式判断 |
| 机构行为 | "分析茅台的机构资金行为" | 机构行为模式 | 识别建仓/减仓 |

#### 4.3 四级资金分布
**功能说明**: 分析四个级别资金的分布情况

**资金级别**:
- 超大单：≥100万元
- 大单：20-100万元
- 中单：4-20万元
- 小单：<4万元

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 资金分布 | "茅台的资金分布情况" | 四级资金占比 | 包含各级别占比 |
| 散户vs机构 | "茅台散户和机构的资金对比" | 资金结构分析 | 区分散户机构 |

**预期响应格式**:
```
#### 3. 四级资金分布
- 超大单：+8,500万 (68%) 📈
- 大单：  +2,000万 (16%) 📈  
- 中单：  -1,500万 (12%) 📉
- 小单：  -500万  (4%)  📉

解读：超大单主导，显示机构积极参与...
```

### 五、混合查询功能

#### 5.1 智能路由
**功能说明**: 自动识别查询类型并路由到合适的处理模块

**路由规则**:
- SQL查询：股价、市值、排名、数值类
- RAG查询：公告、报告、文字描述类
- 财务分析：财务健康、杜邦分析等
- 资金流向：资金流入流出、主力资金等
- 混合查询：需要多种数据的复杂问题

**测试用例**:

| 测试项 | 输入示例 | 预期输出 | 通过标准 |
|--------|----------|----------|----------|
| 复合查询 | "分析茅台的财务和股价表现" | 综合分析结果 | 包含多维度数据 |
| 对比查询 | "比较茅台和五粮液" | 对比分析结果 | 并列展示数据 |

### 六、前端交互功能

#### 6.1 网页界面
**功能说明**: 类ChatGPT的对话式交互界面

**测试项目**:
- [ ] 页面正常加载
- [ ] 输入框功能正常
- [ ] 发送按钮响应
- [ ] 消息正确显示
- [ ] 快捷按钮可用
- [ ] 响应式布局（手机/电脑）

#### 6.2 WebSocket实时通信
**功能说明**: 支持实时对话，无需刷新页面

**测试项目**:
- [ ] WebSocket连接建立
- [ ] 消息实时发送接收
- [ ] 断线自动重连
- [ ] 长时间保持连接

---

## 📊 性能测试标准

| 查询类型 | 期望响应时间 | 可接受范围 |
|----------|-------------|------------|
| SQL查询 | <5秒 | 5-15秒 |
| RAG查询 | <10秒 | 10-30秒 |
| 财务分析 | <20秒 | 20-45秒 |
| 资金流向 | <15秒 | 15-30秒 |
| 混合查询 | <30秒 | 30-60秒 |

---

## 🐛 常见问题检查

### 1. 数据准确性
- [ ] 股价数据是否为最新
- [ ] 财务数据报告期是否正确
- [ ] 资金流向数据是否合理（避免异常大数值）

### 2. 错误处理
- [ ] 无效股票代码的处理
- [ ] 网络超时的处理
- [ ] 数据库连接失败的处理
- [ ] 空查询的处理

### 3. 用户体验
- [ ] 响应速度是否可接受
- [ ] 错误提示是否友好
- [ ] 结果展示是否清晰
- [ ] 是否有加载提示

---

## 📝 测试记录表

| 模块 | 功能点 | 测试结果 | 问题描述 | 优先级 |
|------|--------|----------|----------|--------|
| SQL查询 | 最新股价 | ✅/⚠️/❌ | | 高/中/低 |
| SQL查询 | 历史股价 | ✅/⚠️/❌ | | 高/中/低 |
| RAG查询 | 年报查询 | ✅/⚠️/❌ | | 高/中/低 |
| 财务分析 | 健康度评分 | ✅/⚠️/❌ | | 高/中/低 |
| 资金流向 | 主力资金 | ✅/⚠️/❌ | | 高/中/低 |
| ... | ... | ... | ... | ... |

---

## 🎯 测试完成标准

1. **核心功能测试完成率**: ≥90%
2. **严重错误数量**: 0
3. **一般错误数量**: ≤5
4. **性能达标率**: ≥80%
5. **用户体验评分**: ≥7/10

---

## 📞 问题反馈格式

请按以下格式反馈问题：

```
【模块】：财务分析
【功能】：财务健康度评分
【输入】："分析贵州茅台的财务健康度"
【预期】：返回AA级评分和详细分析
【实际】：返回错误信息"数据获取失败"
【重现步骤】：
1. 打开前端页面
2. 输入查询
3. 等待响应
【优先级】：高
【备注】：可能是数据库连接问题
```

---

祝测试顺利！如有任何问题，请详细记录以便改进。🚀