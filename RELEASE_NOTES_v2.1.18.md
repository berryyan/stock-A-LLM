# 版本发布说明 - v2.1.18

**发布日期**: 2025-07-05  
**版本号**: v2.1.18  
**分支**: dev-react-frontend-v2  

## 🎉 主要更新

### 参数提取器全面增强

本版本对参数提取器（ParameterExtractor）进行了全面增强，大幅提升了自然语言查询的解析能力。

#### 1. 特殊股票名称支持（100%覆盖率）

支持各种特殊格式的股票名称提取：
- **前缀股票**: ST/*ST/S/XD等（如 *ST国华、S佳通、XD国睿科）  
- **后缀股票**: -U/-W/-UW等（如 埃夫特-U、思特威-W、奥比中光-UW）
- **字母后缀**: A/B股（如 万科A、南玻A、特力A）
- **英文+中文**: TCL科技、GQY视讯、C信通等
- **中文数字**: 三六零、七一二、六九一二等特殊命名

#### 2. 日期智能解析增强

- 支持"最后的"关键词（如"招商银行最后的价格"）
- 支持"N年前"模式（如"广东宏大1年前的PE"）
- 支持中文数字年份（如"一年前"、"两年前"）
- 修复月份和年份范围提取功能

#### 3. 多股票提取优化

- 增强连接词支持：和、与、及、vs、VS等
- 改进正则表达式匹配，支持复杂查询
- 修复"大北农"等普通中文股票名称提取问题
- 支持"贵州茅台vs五粮液"等对比查询

#### 4. 错误处理改进

- 股票验证错误信息现在能正确传递到结果中
- 优化限制数量提取逻辑，避免与股票名称冲突
- 增强ST股票的正则表达式匹配准确性

## 📊 测试覆盖

### 测试文件
- `tests/test_parameter_extractor_extended.py`: 扩展参数提取测试
- `tests/test_special_stock_names.py`: 特殊股票名称测试

### 测试结果
- 参数提取器测试：15/15 通过（100%）
- 特殊股票名称测试：27个特殊格式股票全部通过
- 修复前测试通过率：47%
- 修复后测试通过率：100%

## 🔧 技术细节

### 修改的文件
1. `utils/parameter_extractor.py`
   - 增强 `_extract_stocks` 方法
   - 实现 `_extract_month_year_range` 方法
   - 优化 `_extract_limit` 逻辑
   - 修复ST股票正则表达式

2. `utils/unified_stock_validator.py`
   - 扩展股票名称提取模式
   - 增强 `extract_multiple_stocks` 方法
   - 添加更多特殊格式支持

3. `utils/date_intelligence.py`
   - 添加"最后的"到当前时间点关键词
   - 实现"N年前"相对日期模式
   - 支持中文数字年份解析

## 📈 性能影响

- 参数提取性能保持不变（平均<10ms）
- 股票验证查询利用现有缓存机制
- 无额外数据库查询开销

## 🐛 已知问题

无

## 📝 文档更新

- CLAUDE.md 更新至 v2.1.18
- CURRENT_STATUS.md 更新版本信息
- test-guide-comprehensive.md 更新至 v5.3

## 🚀 下一步计划

1. 继续完善查询模块化架构（v2.2.0）
2. 实现更多参数提取功能（如财务指标提取）
3. 优化Agent集成，减少重复代码
4. 扩展测试覆盖率到所有Agent

---

### 开发团队
- 参数提取器增强：Claude Assistant
- 测试用例设计：用户需求驱动
- 特殊股票支持：基于真实数据验证