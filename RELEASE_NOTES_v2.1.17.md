# 版本发布说明 v2.1.17

**发布日期**: 2025-07-04 05:00  
**版本号**: v2.1.17  
**代码名**: SQL Agent提取功能增强

## 📌 版本概述

v2.1.17版本专注于增强SQL Agent的查询参数提取能力，实现了更灵活的日期范围识别、月份/年份自动转换和股票名称智能清理功能。通过统一的参数提取流程，提高了查询的准确性和用户体验。

## ✨ 新增功能

### 1. 日期范围连接符扩展

- **支持多种连接符**: 在原有"到"、"至"基础上，新增支持"-"和"~"作为日期范围连接符
- **灵活的格式识别**: 自动识别多种日期格式组合
- **示例查询**:
  - `贵州茅台2025-06-01至2025-06-30的K线`
  - `万科A2025/6/1~2025/6/30的走势`
  - `中国平安2025-06-01-2025-06-30的行情`

### 2. 月份/年份转日期范围

- **月份转换**: `6月` → `20250601 至 20250630`
- **年份转换**: `2024年` → `20240101 至 20241231`
- **季度支持**: `2025年第二季度` → `20250401 至 20250630`
- **相对时间**: 支持"本月"、"上个月"、"去年"等表达
- **示例查询**:
  - `万科A6月的K线` - 自动转换为当月日期范围
  - `中国平安2024年的K线` - 自动转换为全年日期范围
  - `宁德时代2025年第二季度的走势` - 自动转换为Q2日期范围

### 3. 股票名称智能清理

- **修复日期替换问题**: 解决"万科A前天的成交量"等场景下股票名称提取错误
- **智能后缀清理**: 自动去除时间相关后缀，确保股票名称准确
- **优化提取逻辑**: 从原始查询而非处理后查询提取股票信息，避免日期替换干扰

## 🔧 技术改进

1. **统一参数提取流程**
   - 新增 `_extract_month_year_range()` 方法
   - 增强 `_extract_date_range_from_query()` 方法
   - 优化 `_extract_query_params()` 逻辑

2. **模板配置增强**
   - 完善 `requires_date_range` 属性配置
   - 修正模板的 `requires_stock` 和 `requires_date` 设置

3. **错误处理优化**
   - 增加边界条件检查
   - 完善日期格式验证
   - 提升错误信息的可读性

## 📊 测试结果

- **综合测试**: 27/27 模板测试全部通过
- **K线查询**: 支持日期范围、月份、年份、季度等多种格式
- **成交量查询**: 修复日期替换导致的股票名称提取错误
- **测试文档**: 更新至v5.1版本，新增提取功能测试用例

## 📝 文档更新

- **test-guide-comprehensive.md**: 更新至v5.1版本
  - 新增日期范围连接符测试用例
  - 新增月份/年份转换测试用例
  - 新增股票名称清理测试用例
  
- **CLAUDE.md**: 添加v2.1.17版本说明
- **CURRENT_STATUS.md**: 更新项目状态至v2.1.17

## 🎯 下一步计划

1. **继续7-Agent架构开发**
   - Phase 2: 设计并实现新的Agent（Rank、ANNS、QA）
   - Phase 3: 专业Agent快速路径优化
   
2. **SQL Agent进一步优化**
   - 实现更多快速查询模板
   - 优化查询性能
   - 增强错误恢复机制

## 📌 注意事项

- 所有日期范围查询现在支持更灵活的连接符
- 月份和年份查询会自动转换为对应的日期范围
- 股票名称提取更加准确，避免了日期替换的干扰

## 🔗 相关链接

- GitHub仓库: https://github.com/berryyan/stock-A-LLM
- 分支: dev-react-frontend-v2
- Commit: a6ae1fc