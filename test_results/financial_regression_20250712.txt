2025-07-12 22:12:44 - mysql_connector - INFO - MySQL连接成功: 10.0.0.77:3306/Tushare
2025-07-12 22:12:44 - mysql_connector - INFO - MySQL连接器初始化完成
2025-07-12 22:12:44 - schema_knowledge_base - INFO - 开始构建Schema知识库...
2025-07-12 22:12:44 - schema_knowledge_base - INFO - Schema知识库构建完成，耗时: 0.17秒
2025-07-12 22:12:44 - mysql_connector - INFO - MySQL连接成功: 10.0.0.77:3306/Tushare
2025-07-12 22:12:44 - mysql_connector - INFO - MySQL连接器初始化完成
2025-07-12 22:12:44 - date_intelligence - INFO - 已清理所有日期智能解析缓存
2025-07-12 22:12:45 - mysql_connector - INFO - MySQL连接成功: 10.0.0.77:3306/Tushare
2025-07-12 22:12:45 - mysql_connector - INFO - MySQL连接器初始化完成
2025-07-12 22:12:45 - financial_agent - INFO - 从Schema知识库获取财务表结构: ['tu_income', 'tu_balancesheet', 'tu_cashflow', 'tu_fina_indicator']
2025-07-12 22:12:45 - financial_agent - INFO - Schema知识库已加载: 15个表, 549个字段
2025-07-12 22:12:45 - financial_agent - INFO - Financial Analysis Agent初始化完成
2025-07-12 22:12:45 - financial_agent_modular - INFO - Financial Agent模块化版本初始化完成
================================================================================
Financial Agent 综合测试 - Windows优化版
测试时间: 2025-07-12 22:12:45
================================================================================

============================================================
测试类别: 1.财务健康度分析
============================================================

正向测试用例:

[1.财务健康度分析] 完整名称
查询: 分析贵州茅台的财务健康度
期望: 成功
2025-07-12 22:12:45 - financial_agent_modular - INFO - 收到财务分析查询: 分析贵州茅台的财务健康度
2025-07-12 22:12:45 - mysql_connector - INFO - MySQL连接成功: 10.0.0.77:3306/Tushare
2025-07-12 22:12:45 - mysql_connector - INFO - MySQL连接器初始化完成
2025-07-12 22:12:45 - stock_code_mapper - INFO - 开始刷新股票代码缓存
2025-07-12 22:12:45 - stock_code_mapper - INFO - 股票代码缓存刷新完成，共缓存21695个映射
2025-07-12 22:12:45 - unified_stock_validator - INFO - 从查询词 '贵州茅台' 转换为: 600519.SH
2025-07-12 22:12:45 - unified_stock_validator - INFO - 从查询中提取到股票: 600519.SH
2025-07-12 22:12:45 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comprehensive
2025-07-12 22:12:45 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:12:45 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:12:45 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:12:45 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:12:45 - mysql_connector - INFO - MySQL连接成功: 10.0.0.77:3306/Tushare
2025-07-12 22:12:45 - mysql_connector - INFO - MySQL连接器初始化完成
2025-07-12 22:12:45 - sector_code_mapper - INFO - 开始刷新板块代码缓存
2025-07-12 22:12:45 - sector_code_mapper - INFO - 板块代码缓存刷新完成，共缓存586个板块映射
2025-07-12 22:12:45 - sector_code_mapper - INFO - 板块类型分布: {'行业': 86, '概念': 469, '地域': 31}
2025-07-12 22:12:45 - mysql_connector - INFO - MySQL连接成功: 10.0.0.77:3306/Tushare
2025-07-12 22:12:45 - mysql_connector - INFO - MySQL连接器初始化完成
2025-07-12 22:12:45 - sector_code_mapper - INFO - 开始刷新板块代码缓存
2025-07-12 22:12:45 - sector_code_mapper - INFO - 板块代码缓存刷新完成，共缓存586个板块映射
2025-07-12 22:12:45 - sector_code_mapper - INFO - 板块类型分布: {'行业': 86, '概念': 469, '地域': 31}
2025-07-12 22:12:45 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:12:45 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:12:45 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:12:45 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:12:45 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:12:45 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:12:45 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:13:35 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[1.财务健康度分析] 股票代码
查询: 分析600519.SH的财务健康度
期望: 成功
2025-07-12 22:13:35 - financial_agent_modular - INFO - 收到财务分析查询: 分析600519.SH的财务健康度
2025-07-12 22:13:35 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: financial_health
2025-07-12 22:13:35 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:13:35 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:13:35 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:13:35 - parameter_extractor - INFO - 数量限制: 600519
2025-07-12 22:13:35 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:13:35 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:13:35 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:13:35 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:13:35 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:13:35 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:13:35 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:14:20 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[1.财务健康度分析] 银行股
查询: 分析平安银行的财务健康度
期望: 成功
2025-07-12 22:14:20 - financial_agent_modular - INFO - 收到财务分析查询: 分析平安银行的财务健康度
2025-07-12 22:14:20 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 分析平安银行
2025-07-12 22:14:20 - unified_stock_validator - INFO - 从查询词 '平安银行' 转换为: 000001.SZ
2025-07-12 22:14:20 - unified_stock_validator - INFO - 从查询中提取到股票: 000001.SZ
2025-07-12 22:14:20 - unified_stock_validator - INFO - 成功提取股票代码: 000001.SZ, 查询意图: comprehensive
2025-07-12 22:14:20 - unified_stock_validator - INFO - 从查询词 '平安银行' 转换为: 000001.SZ
2025-07-12 22:14:20 - unified_stock_validator - INFO - 从查询中提取到股票: 000001.SZ
2025-07-12 22:14:20 - unified_stock_validator - INFO - 成功提取股票代码: 000001.SZ, 查询意图: comprehensive
2025-07-12 22:14:20 - stock_validation_helper - INFO - 股票验证成功: 000001.SZ -> 000001.SZ (平安银行)
2025-07-12 22:14:20 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:14:20 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:14:20 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:14:20 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:14:20 - financial_agent_modular - INFO - 开始分析 000001.SZ 的财务健康度
2025-07-12 22:14:20 - financial_agent_modular - INFO - 正在获取 000001.SZ 的财务数据...
2025-07-12 22:14:20 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:14:20 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:14:20 - financial_agent_modular - INFO - 财务健康度评分: 57.0 (BB)
2025-07-12 22:14:20 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:15:04 - financial_agent_modular - INFO - 财务健康度分析完成: 000001.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[1.财务健康度分析] 财务状况
查询: 分析万科A的财务状况
期望: 成功
2025-07-12 22:15:04 - financial_agent_modular - INFO - 收到财务分析查询: 分析万科A的财务状况
2025-07-12 22:15:04 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 分析万科A
2025-07-12 22:15:04 - unified_stock_validator - INFO - 从查询词 '万科A' 转换为: 000002.SZ
2025-07-12 22:15:04 - unified_stock_validator - INFO - 从查询中提取到股票: 000002.SZ
2025-07-12 22:15:04 - unified_stock_validator - INFO - 成功提取股票代码: 000002.SZ, 查询意图: comprehensive
2025-07-12 22:15:04 - stock_validation_helper - INFO - 股票验证成功: 000002.SZ -> 000002.SZ (万科A)
2025-07-12 22:15:04 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:15:04 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:15:04 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:15:04 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:15:04 - financial_agent_modular - INFO - 开始分析 000002.SZ 的财务健康度
2025-07-12 22:15:04 - financial_agent_modular - INFO - 正在获取 000002.SZ 的财务数据...
2025-07-12 22:15:04 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:15:04 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:15:04 - financial_agent_modular - INFO - 财务健康度评分: 34.0 (CCC)
2025-07-12 22:15:04 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:15:49 - financial_agent_modular - INFO - 财务健康度分析完成: 000002.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

负向测试用例:

[1.财务健康度分析] 股票简称
查询: 茅台的财务健康度
期望: 失败
2025-07-12 22:15:49 - financial_agent_modular - INFO - 收到财务分析查询: 茅台的财务健康度
2025-07-12 22:15:49 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 茅台
2025-07-12 22:15:49 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 茅台的
2025-07-12 22:15:49 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:15:49 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:15:49 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:15:49 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:15:49 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[1.财务健康度分析] 空查询
查询: 
期望: 失败
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[1.财务健康度分析] 错误代码
查询: 12345的财务健康度
期望: 失败
2025-07-12 22:15:49 - financial_agent_modular - INFO - 收到财务分析查询: 12345的财务健康度
2025-07-12 22:15:49 - unified_stock_validator - WARNING - 股票代码长度不正确: 12345 (应为6位)
2025-07-12 22:15:49 - unified_stock_validator - WARNING - 股票代码长度不正确: 12345 (应为6位)
2025-07-12 22:15:49 - parameter_extractor - WARNING - 股票验证失败: 股票代码应为6位数字，您输入了5位
2025-07-12 22:15:49 - parameter_extractor - INFO - 数量限制: 12345
2025-07-12 22:15:49 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:15:49 - unified_stock_validator - WARNING - 股票代码长度不正确: 12345 (应为6位)
2025-07-12 22:15:49 - unified_stock_validator - WARNING - 股票代码长度不正确: 12345 (应为6位)
2025-07-12 22:15:49 - parameter_extractor - WARNING - 股票验证失败: 股票代码应为6位数字，您输入了5位
2025-07-12 22:15:49 - parameter_extractor - INFO - 数量限制: 12345
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[1.财务健康度分析] 小写后缀
查询: 600519.sh的财务健康度
期望: 失败
2025-07-12 22:15:49 - financial_agent_modular - INFO - 收到财务分析查询: 600519.sh的财务健康度
2025-07-12 22:15:49 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sh
2025-07-12 22:15:49 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sh
2025-07-12 22:15:49 - parameter_extractor - WARNING - 股票验证失败: 证券代码后缀大小写错误，应为.SH
2025-07-12 22:15:49 - parameter_extractor - INFO - 数量限制: 600519
2025-07-12 22:15:49 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:15:49 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sh
2025-07-12 22:15:49 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sh
2025-07-12 22:15:49 - parameter_extractor - WARNING - 股票验证失败: 证券代码后缀大小写错误，应为.SH
2025-07-12 22:15:49 - parameter_extractor - INFO - 数量限制: 600519
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

============================================================
测试类别: 2.杜邦分析
============================================================

正向测试用例:

[2.杜邦分析] 完整名称
查询: 贵州茅台的杜邦分析
期望: 成功
2025-07-12 22:15:49 - financial_agent_modular - INFO - 收到财务分析查询: 贵州茅台的杜邦分析
2025-07-12 22:15:49 - unified_stock_validator - INFO - 从查询词 '贵州茅台' 转换为: 600519.SH
2025-07-12 22:15:49 - unified_stock_validator - INFO - 从查询中提取到股票: 600519.SH
2025-07-12 22:15:49 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comprehensive
2025-07-12 22:15:49 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 的杜邦
2025-07-12 22:15:49 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 杜邦
2025-07-12 22:15:49 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:15:49 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:15:49 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:15:49 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:15:49 - financial_agent_modular - INFO - 识别到分析类型: dupont
2025-07-12 22:15:49 - financial_agent_modular - INFO - 开始对 600519.SH 进行杜邦分析
2025-07-12 22:15:49 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:15:49 - financial_agent_modular - INFO - 正在计算杜邦分析指标...
2025-07-12 22:15:49 - financial_agent_modular - INFO - ROE分解: 净利率=52.19%, 资产周转率=0.17, 权益乘数=1.16
2025-07-12 22:15:49 - financial_agent_modular - INFO - 正在分析杜邦指标趋势...
2025-07-12 22:15:49 - financial_agent_modular - INFO - 正在生成杜邦分析报告...
2025-07-12 22:16:38 - financial_agent_modular - INFO - 杜邦分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[2.杜邦分析] ROE分解
查询: 平安银行ROE分解分析
期望: 成功
2025-07-12 22:16:38 - financial_agent_modular - INFO - 收到财务分析查询: 平安银行ROE分解分析
2025-07-12 22:16:38 - stock_code_mapper - WARNING - 无法转换实体到ts_code: ROE分解分析
2025-07-12 22:16:38 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 分解
2025-07-12 22:16:38 - stock_code_mapper - WARNING - 无法转换实体到ts_code: ROE分解
2025-07-12 22:16:38 - unified_stock_validator - INFO - 从查询中提取到股票名称 '平安银行'，转换为: 000001.SZ
2025-07-12 22:16:38 - unified_stock_validator - INFO - 从查询中提取到股票: 000001.SZ
2025-07-12 22:16:38 - unified_stock_validator - INFO - 成功提取股票代码: 000001.SZ, 查询意图: profitability
2025-07-12 22:16:38 - stock_validation_helper - INFO - 股票验证成功: 000001.SZ -> 000001.SZ (平安银行)
2025-07-12 22:16:38 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:16:38 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:16:38 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:16:38 - financial_agent_modular - INFO - 识别到分析类型: profitability
2025-07-12 22:16:38 - financial_agent_modular - INFO - 开始分析 000001.SZ 的财务健康度
2025-07-12 22:16:38 - financial_agent_modular - INFO - 正在获取 000001.SZ 的财务数据...
2025-07-12 22:16:38 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:16:38 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:16:38 - financial_agent_modular - INFO - 财务健康度评分: 57.0 (BB)
2025-07-12 22:16:38 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:17:19 - financial_agent_modular - INFO - 财务健康度分析完成: 000001.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[2.杜邦分析] 股票代码
查询: 600519.SH的杜邦分析
期望: 成功
2025-07-12 22:17:19 - financial_agent_modular - INFO - 收到财务分析查询: 600519.SH的杜邦分析
2025-07-12 22:17:19 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: dupont
2025-07-12 22:17:19 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:17:19 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:17:19 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:17:19 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:17:19 - financial_agent_modular - INFO - 识别到分析类型: dupont
2025-07-12 22:17:19 - financial_agent_modular - INFO - 开始对 600519.SH 进行杜邦分析
2025-07-12 22:17:19 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:17:19 - financial_agent_modular - INFO - 正在计算杜邦分析指标...
2025-07-12 22:17:19 - financial_agent_modular - INFO - ROE分解: 净利率=52.19%, 资产周转率=0.17, 权益乘数=1.16
2025-07-12 22:17:19 - financial_agent_modular - INFO - 正在分析杜邦指标趋势...
2025-07-12 22:17:19 - financial_agent_modular - INFO - 正在生成杜邦分析报告...
2025-07-12 22:18:04 - financial_agent_modular - INFO - 杜邦分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[2.杜邦分析] 分析ROE
查询: 分析万科A的ROE
期望: 成功
2025-07-12 22:18:04 - financial_agent_modular - INFO - 收到财务分析查询: 分析万科A的ROE
2025-07-12 22:18:04 - unified_stock_validator - INFO - 从查询词 '万科A' 转换为: 000002.SZ
2025-07-12 22:18:04 - unified_stock_validator - INFO - 从查询中提取到股票: 000002.SZ
2025-07-12 22:18:04 - unified_stock_validator - INFO - 成功提取股票代码: 000002.SZ, 查询意图: comprehensive
2025-07-12 22:18:04 - stock_validation_helper - INFO - 股票验证成功: 000002.SZ -> 000002.SZ (万科A)
2025-07-12 22:18:04 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:18:04 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:18:04 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:18:04 - financial_agent_modular - INFO - 识别到分析类型: profitability
2025-07-12 22:18:04 - financial_agent_modular - INFO - 开始分析 000002.SZ 的财务健康度
2025-07-12 22:18:04 - financial_agent_modular - INFO - 正在获取 000002.SZ 的财务数据...
2025-07-12 22:18:04 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:18:04 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:18:04 - financial_agent_modular - INFO - 财务健康度评分: 34.0 (CCC)
2025-07-12 22:18:04 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:18:49 - financial_agent_modular - INFO - 财务健康度分析完成: 000002.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

负向测试用例:

[2.杜邦分析] 股票简称
查询: 茅台的杜邦分析
期望: 失败
2025-07-12 22:18:49 - financial_agent_modular - INFO - 收到财务分析查询: 茅台的杜邦分析
2025-07-12 22:18:49 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 茅台的杜邦
2025-07-12 22:18:49 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:18:49 - financial_agent_modular - INFO - 识别到分析类型: dupont
2025-07-12 22:18:49 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[2.杜邦分析] 缺少股票
查询: 杜邦分析
期望: 失败
2025-07-12 22:18:49 - financial_agent_modular - INFO - 收到财务分析查询: 杜邦分析
2025-07-12 22:18:49 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:18:49 - financial_agent_modular - INFO - 识别到分析类型: dupont
2025-07-12 22:18:49 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[2.杜邦分析] 小写后缀
查询: 600519.sz的杜邦分析
期望: 失败
2025-07-12 22:18:49 - financial_agent_modular - INFO - 收到财务分析查询: 600519.sz的杜邦分析
2025-07-12 22:18:49 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sz
2025-07-12 22:18:49 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sz
2025-07-12 22:18:49 - parameter_extractor - WARNING - 股票验证失败: 证券代码后缀大小写错误，应为.SZ
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 600519
2025-07-12 22:18:49 - financial_agent_modular - INFO - 识别到分析类型: dupont
2025-07-12 22:18:49 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sz
2025-07-12 22:18:49 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sz
2025-07-12 22:18:49 - parameter_extractor - WARNING - 股票验证失败: 证券代码后缀大小写错误，应为.SZ
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 600519
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[2.杜邦分析] 无效股票
查询: 不存在公司的杜邦分析
期望: 失败
2025-07-12 22:18:49 - financial_agent_modular - INFO - 收到财务分析查询: 不存在公司的杜邦分析
2025-07-12 22:18:49 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 不存在公司
2025-07-12 22:18:49 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 在公司的杜邦
2025-07-12 22:18:49 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:18:49 - financial_agent_modular - INFO - 识别到分析类型: dupont
2025-07-12 22:18:49 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

============================================================
测试类别: 3.现金流质量分析
============================================================

正向测试用例:

[3.现金流质量分析] 完整名称
查询: 分析万科A的现金流质量
期望: 成功
2025-07-12 22:18:49 - financial_agent_modular - INFO - 收到财务分析查询: 分析万科A的现金流质量
2025-07-12 22:18:49 - unified_stock_validator - INFO - 从查询词 '万科A' 转换为: 000002.SZ
2025-07-12 22:18:49 - unified_stock_validator - INFO - 从查询中提取到股票: 000002.SZ
2025-07-12 22:18:49 - unified_stock_validator - INFO - 成功提取股票代码: 000002.SZ, 查询意图: comprehensive
2025-07-12 22:18:49 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 现金流质量
2025-07-12 22:18:49 - stock_validation_helper - INFO - 股票验证成功: 000002.SZ -> 000002.SZ (万科A)
2025-07-12 22:18:49 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:18:49 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:18:49 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:18:49 - financial_agent_modular - INFO - 识别到分析类型: cash_flow
2025-07-12 22:18:49 - financial_agent_modular - INFO - 开始对 000002.SZ 进行现金流质量分析
2025-07-12 22:18:49 - financial_agent_modular - INFO - 正在获取 000002.SZ 的8期财务数据...
2025-07-12 22:18:49 - financial_agent_modular - INFO - 正在分析现金流质量指标...
2025-07-12 22:18:49 - financial_agent_modular - INFO - 现金流质量评级: B, 平均现金含量: 4.57
2025-07-12 22:18:49 - financial_agent_modular - INFO - 正在生成现金流质量分析报告...
2025-07-12 22:19:35 - financial_agent_modular - INFO - 现金流质量分析完成: 000002.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[3.现金流质量分析] 股票代码
查询: 分析000002.SZ的现金流质量
期望: 成功
2025-07-12 22:19:35 - financial_agent_modular - INFO - 收到财务分析查询: 分析000002.SZ的现金流质量
2025-07-12 22:19:35 - unified_stock_validator - INFO - 成功提取股票代码: 000002.SZ, 查询意图: cash_flow
2025-07-12 22:19:35 - stock_validation_helper - INFO - 股票验证成功: 000002.SZ -> 000002.SZ (万科A)
2025-07-12 22:19:35 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:19:35 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:19:35 - parameter_extractor - INFO - 数量限制: 2
2025-07-12 22:19:35 - financial_agent_modular - INFO - 识别到分析类型: cash_flow
2025-07-12 22:19:35 - financial_agent_modular - INFO - 开始对 000002.SZ 进行现金流质量分析
2025-07-12 22:19:35 - financial_agent_modular - INFO - 正在获取 000002.SZ 的8期财务数据...
2025-07-12 22:19:35 - financial_agent_modular - INFO - 正在分析现金流质量指标...
2025-07-12 22:19:35 - financial_agent_modular - INFO - 现金流质量评级: B, 平均现金含量: 4.57
2025-07-12 22:19:35 - financial_agent_modular - INFO - 正在生成现金流质量分析报告...
2025-07-12 22:20:18 - financial_agent_modular - INFO - 现金流质量分析完成: 000002.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[3.现金流质量分析] 评估
查询: 评估平安银行的现金流
期望: 成功
2025-07-12 22:20:18 - financial_agent_modular - INFO - 收到财务分析查询: 评估平安银行的现金流
2025-07-12 22:20:18 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 评估平安银行
2025-07-12 22:20:18 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 现金流
2025-07-12 22:20:18 - unified_stock_validator - INFO - 从查询中提取到股票名称 '平安银行'，转换为: 000001.SZ
2025-07-12 22:20:18 - unified_stock_validator - INFO - 从查询中提取到股票: 000001.SZ
2025-07-12 22:20:18 - unified_stock_validator - INFO - 成功提取股票代码: 000001.SZ, 查询意图: cash_flow
2025-07-12 22:20:18 - stock_validation_helper - INFO - 股票验证成功: 000001.SZ -> 000001.SZ (平安银行)
2025-07-12 22:20:18 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:20:18 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:20:18 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:20:18 - financial_agent_modular - INFO - 识别到分析类型: cash_flow
2025-07-12 22:20:18 - financial_agent_modular - INFO - 开始对 000001.SZ 进行现金流质量分析
2025-07-12 22:20:18 - financial_agent_modular - INFO - 正在获取 000001.SZ 的8期财务数据...
2025-07-12 22:20:19 - financial_agent_modular - INFO - 正在分析现金流质量指标...
2025-07-12 22:20:19 - financial_agent_modular - INFO - 现金流质量评级: B, 平均现金含量: 3.26
2025-07-12 22:20:19 - financial_agent_modular - INFO - 正在生成现金流质量分析报告...
2025-07-12 22:21:02 - financial_agent_modular - INFO - 现金流质量分析完成: 000001.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[3.现金流质量分析] 含量比率
查询: 贵州茅台的现金含量比率
期望: 成功
2025-07-12 22:21:02 - financial_agent_modular - INFO - 收到财务分析查询: 贵州茅台的现金含量比率
2025-07-12 22:21:02 - unified_stock_validator - INFO - 从查询词 '贵州茅台' 转换为: 600519.SH
2025-07-12 22:21:02 - unified_stock_validator - INFO - 从查询中提取到股票: 600519.SH
2025-07-12 22:21:02 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comprehensive
2025-07-12 22:21:02 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 现金含量比率
2025-07-12 22:21:02 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:21:02 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:21:02 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:21:02 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:21:02 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:21:02 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:21:02 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:21:02 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:21:02 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:21:02 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:21:02 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:21:44 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

负向测试用例:

[3.现金流质量分析] 股票简称
查询: 万科的现金流
期望: 失败
2025-07-12 22:21:44 - financial_agent_modular - INFO - 收到财务分析查询: 万科的现金流
2025-07-12 22:21:44 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 万科
2025-07-12 22:21:44 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:21:44 - parameter_extractor - INFO - 数量限制: 10000
2025-07-12 22:21:44 - financial_agent_modular - INFO - 识别到分析类型: cash_flow
2025-07-12 22:21:44 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:21:44 - parameter_extractor - INFO - 数量限制: 10000
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[3.现金流质量分析] 缺少股票
查询: 现金流质量
期望: 失败
2025-07-12 22:21:44 - financial_agent_modular - INFO - 收到财务分析查询: 现金流质量
2025-07-12 22:21:44 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:21:44 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:21:44 - financial_agent_modular - INFO - 识别到分析类型: cash_flow
2025-07-12 22:21:44 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:21:44 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[3.现金流质量分析] 空白查询
查询:    
期望: 失败
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[3.现金流质量分析] 错误后缀
查询: 000002.SH的现金流
期望: 失败
2025-07-12 22:21:44 - financial_agent_modular - INFO - 收到财务分析查询: 000002.SH的现金流
2025-07-12 22:21:44 - stock_code_mapper - WARNING - 无法转换实体到ts_code: SH的现金流
2025-07-12 22:21:44 - stock_code_mapper - WARNING - 无法转换实体到ts_code: SH
2025-07-12 22:21:44 - unified_stock_validator - WARNING - 股票代码不存在: 000002.SH
2025-07-12 22:21:44 - unified_stock_validator - WARNING - 股票代码不存在: 000002.SH
2025-07-12 22:21:44 - parameter_extractor - WARNING - 股票验证失败: 股票代码000002.SH不存在，请检查是否输入正确
2025-07-12 22:21:44 - parameter_extractor - INFO - 数量限制: 2
2025-07-12 22:21:44 - financial_agent_modular - INFO - 识别到分析类型: cash_flow
2025-07-12 22:21:44 - unified_stock_validator - WARNING - 股票代码不存在: 000002.SH
2025-07-12 22:21:44 - unified_stock_validator - WARNING - 股票代码不存在: 000002.SH
2025-07-12 22:21:44 - parameter_extractor - WARNING - 股票验证失败: 股票代码000002.SH不存在，请检查是否输入正确
2025-07-12 22:21:44 - parameter_extractor - INFO - 数量限制: 2
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

============================================================
测试类别: 4.多期财务对比
============================================================

正向测试用例:

[4.多期财务对比] 指定期数
查询: 贵州茅台最近3期财务对比
期望: 成功
2025-07-12 22:21:44 - financial_agent_modular - INFO - 收到财务分析查询: 贵州茅台最近3期财务对比
2025-07-12 22:21:44 - unified_stock_validator - INFO - 从查询中提取到股票名称 '贵州茅台'，转换为: 600519.SH
2025-07-12 22:21:44 - unified_stock_validator - INFO - 从查询中提取到股票: 600519.SH
2025-07-12 22:21:44 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comprehensive
2025-07-12 22:21:44 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:21:44 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:21:44 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:21:44 - parameter_extractor - INFO - 数量限制: 3
2025-07-12 22:21:44 - financial_agent_modular - INFO - 识别到分析类型: comparison
2025-07-12 22:21:44 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:21:44 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:21:44 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:21:44 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:21:44 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:21:44 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:22:28 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[4.多期财务对比] 财务变化
查询: 600519.SH最近几期的财务变化
期望: 成功
2025-07-12 22:22:28 - financial_agent_modular - INFO - 收到财务分析查询: 600519.SH最近几期的财务变化
2025-07-12 22:22:28 - stock_code_mapper - WARNING - 无法转换实体到ts_code: SH最近几期
2025-07-12 22:22:28 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 最近几期
2025-07-12 22:22:28 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 变化
2025-07-12 22:22:28 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comparison
2025-07-12 22:22:28 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:22:28 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:22:28 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:22:28 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:22:28 - financial_agent_modular - INFO - 识别到分析类型: comparison
2025-07-12 22:22:28 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:22:28 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:22:28 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:22:28 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:22:28 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:22:28 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:23:13 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[4.多期财务对比] 财务趋势
查询: 分析平安银行的财务趋势
期望: 成功
2025-07-12 22:23:13 - financial_agent_modular - INFO - 收到财务分析查询: 分析平安银行的财务趋势
2025-07-12 22:23:13 - unified_stock_validator - INFO - 从查询词 '平安银行' 转换为: 000001.SZ
2025-07-12 22:23:13 - unified_stock_validator - INFO - 从查询中提取到股票: 000001.SZ
2025-07-12 22:23:13 - unified_stock_validator - INFO - 成功提取股票代码: 000001.SZ, 查询意图: comprehensive
2025-07-12 22:23:13 - unified_stock_validator - INFO - 从查询词 '平安银行' 转换为: 000001.SZ
2025-07-12 22:23:13 - unified_stock_validator - INFO - 从查询中提取到股票: 000001.SZ
2025-07-12 22:23:13 - unified_stock_validator - INFO - 成功提取股票代码: 000001.SZ, 查询意图: comprehensive
2025-07-12 22:23:13 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 趋势
2025-07-12 22:23:13 - stock_validation_helper - INFO - 股票验证成功: 000001.SZ -> 000001.SZ (平安银行)
2025-07-12 22:23:13 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:23:13 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:23:13 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:23:13 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:23:13 - financial_agent_modular - INFO - 开始分析 000001.SZ 的财务健康度
2025-07-12 22:23:13 - financial_agent_modular - INFO - 正在获取 000001.SZ 的财务数据...
2025-07-12 22:23:13 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:23:13 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:23:13 - financial_agent_modular - INFO - 财务健康度评分: 57.0 (BB)
2025-07-12 22:23:13 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:23:56 - financial_agent_modular - INFO - 财务健康度分析完成: 000001.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[4.多期财务对比] 季度对比
查询: 万科A的季度财务对比分析
期望: 成功
2025-07-12 22:23:56 - financial_agent_modular - INFO - 收到财务分析查询: 万科A的季度财务对比分析
2025-07-12 22:23:56 - unified_stock_validator - INFO - 从查询中提取到股票名称 '万科A'，转换为: 000002.SZ
2025-07-12 22:23:56 - unified_stock_validator - INFO - 从查询中提取到股票: 000002.SZ
2025-07-12 22:23:56 - unified_stock_validator - INFO - 成功提取股票代码: 000002.SZ, 查询意图: comprehensive
2025-07-12 22:23:56 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 财务对比
2025-07-12 22:23:56 - stock_validation_helper - INFO - 股票验证成功: 000002.SZ -> 000002.SZ (万科A)
2025-07-12 22:23:56 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:23:56 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:23:56 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:23:56 - financial_agent_modular - INFO - 识别到分析类型: comparison
2025-07-12 22:23:56 - financial_agent_modular - INFO - 开始分析 000002.SZ 的财务健康度
2025-07-12 22:23:56 - financial_agent_modular - INFO - 正在获取 000002.SZ 的财务数据...
2025-07-12 22:23:56 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:23:56 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:23:56 - financial_agent_modular - INFO - 财务健康度评分: 34.0 (CCC)
2025-07-12 22:23:56 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:24:48 - financial_agent_modular - INFO - 财务健康度分析完成: 000002.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

负向测试用例:

[4.多期财务对比] 股票简称
查询: 茅台对比
期望: 失败
2025-07-12 22:24:48 - financial_agent_modular - INFO - 收到财务分析查询: 茅台对比
2025-07-12 22:24:48 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:24:48 - financial_agent_modular - INFO - 识别到分析类型: comparison
2025-07-12 22:24:48 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[4.多期财务对比] 缺少股票
查询: 财务对比
期望: 失败
2025-07-12 22:24:48 - financial_agent_modular - INFO - 收到财务分析查询: 财务对比
2025-07-12 22:24:48 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:24:48 - financial_agent_modular - INFO - 识别到分析类型: comparison
2025-07-12 22:24:48 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[4.多期财务对比] 无效代码
查询: 123456最近的对比
期望: 失败
2025-07-12 22:24:48 - financial_agent_modular - INFO - 收到财务分析查询: 123456最近的对比
2025-07-12 22:24:48 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 最近
2025-07-12 22:24:48 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 123456最近
2025-07-12 22:24:48 - mysql_connector - ERROR - 查询执行失败: List argument must consist only of tuples or dictionaries
2025-07-12 22:24:48 - mysql_connector - ERROR - 查询语句: 
            SELECT ts_code 
            FROM tu_stock_basic 
            WHERE symbol = %s AND list_status = 'L'
            LIMIT 1
            
2025-07-12 22:24:48 - stock_code_mapper - ERROR - 查询symbol失败: List argument must consist only of tuples or dictionaries
2025-07-12 22:24:48 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 123456
2025-07-12 22:24:48 - financial_agent_modular - INFO - 识别到分析类型: comparison
2025-07-12 22:24:48 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 123456
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[4.多期财务对比] 小写后缀
查询: 600519.sz财务对比
期望: 失败
2025-07-12 22:24:48 - financial_agent_modular - INFO - 收到财务分析查询: 600519.sz财务对比
2025-07-12 22:24:48 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sz
2025-07-12 22:24:48 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sz
2025-07-12 22:24:48 - parameter_extractor - WARNING - 股票验证失败: 证券代码后缀大小写错误，应为.SZ
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 600519
2025-07-12 22:24:48 - financial_agent_modular - INFO - 识别到分析类型: comparison
2025-07-12 22:24:48 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sz
2025-07-12 22:24:48 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sz
2025-07-12 22:24:48 - parameter_extractor - WARNING - 股票验证失败: 证券代码后缀大小写错误，应为.SZ
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 600519
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

============================================================
测试类别: 5.盈利能力分析
============================================================

正向测试用例:

[5.盈利能力分析] 完整名称
查询: 分析比亚迪的盈利能力
期望: 成功
2025-07-12 22:24:48 - financial_agent_modular - INFO - 收到财务分析查询: 分析比亚迪的盈利能力
2025-07-12 22:24:48 - unified_stock_validator - INFO - 从查询词 '比亚迪' 转换为: 002594.SZ
2025-07-12 22:24:48 - unified_stock_validator - INFO - 从查询中提取到股票: 002594.SZ
2025-07-12 22:24:48 - unified_stock_validator - INFO - 成功提取股票代码: 002594.SZ, 查询意图: comprehensive
2025-07-12 22:24:48 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 盈利能力
2025-07-12 22:24:48 - stock_validation_helper - INFO - 股票验证成功: 002594.SZ -> 002594.SZ (比亚迪)
2025-07-12 22:24:48 - parameter_extractor - INFO - 提取到股票: ['002594.SZ']
2025-07-12 22:24:48 - parameter_extractor - INFO - 提取到股票: ['002594.SZ']
2025-07-12 22:24:48 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:24:48 - financial_agent_modular - INFO - 识别到分析类型: profitability
2025-07-12 22:24:48 - financial_agent_modular - INFO - 开始分析 002594.SZ 的财务健康度
2025-07-12 22:24:48 - financial_agent_modular - INFO - 正在获取 002594.SZ 的财务数据...
2025-07-12 22:24:48 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:24:48 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:24:48 - financial_agent_modular - INFO - 财务健康度评分: 42.5 (B)
2025-07-12 22:24:48 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:25:40 - financial_agent_modular - INFO - 财务健康度分析完成: 002594.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[5.盈利能力分析] 股票代码
查询: 分析002594.SZ的盈利能力
期望: 成功
2025-07-12 22:25:40 - financial_agent_modular - INFO - 收到财务分析查询: 分析002594.SZ的盈利能力
2025-07-12 22:25:40 - unified_stock_validator - INFO - 成功提取股票代码: 002594.SZ, 查询意图: profitability
2025-07-12 22:25:40 - stock_validation_helper - INFO - 股票验证成功: 002594.SZ -> 002594.SZ (比亚迪)
2025-07-12 22:25:40 - parameter_extractor - INFO - 提取到股票: ['002594.SZ']
2025-07-12 22:25:40 - parameter_extractor - INFO - 提取到股票: ['002594.SZ']
2025-07-12 22:25:40 - parameter_extractor - INFO - 数量限制: 2594
2025-07-12 22:25:40 - financial_agent_modular - INFO - 识别到分析类型: profitability
2025-07-12 22:25:40 - financial_agent_modular - INFO - 开始分析 002594.SZ 的财务健康度
2025-07-12 22:25:40 - financial_agent_modular - INFO - 正在获取 002594.SZ 的财务数据...
2025-07-12 22:25:40 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:25:40 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:25:40 - financial_agent_modular - INFO - 财务健康度评分: 42.5 (B)
2025-07-12 22:25:40 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:26:26 - financial_agent_modular - INFO - 财务健康度分析完成: 002594.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[5.盈利能力分析] 毛利率
查询: 万科A的毛利率分析
期望: 成功
2025-07-12 22:26:26 - financial_agent_modular - INFO - 收到财务分析查询: 万科A的毛利率分析
2025-07-12 22:26:26 - unified_stock_validator - INFO - 从查询中提取到股票名称 '万科A'，转换为: 000002.SZ
2025-07-12 22:26:26 - unified_stock_validator - INFO - 从查询中提取到股票: 000002.SZ
2025-07-12 22:26:26 - unified_stock_validator - INFO - 成功提取股票代码: 000002.SZ, 查询意图: comprehensive
2025-07-12 22:26:26 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 的毛利率
2025-07-12 22:26:26 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 毛利率
2025-07-12 22:26:26 - stock_validation_helper - INFO - 股票验证成功: 000002.SZ -> 000002.SZ (万科A)
2025-07-12 22:26:26 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:26:26 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:26:26 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:26:26 - financial_agent_modular - INFO - 识别到分析类型: profitability
2025-07-12 22:26:26 - financial_agent_modular - INFO - 开始分析 000002.SZ 的财务健康度
2025-07-12 22:26:26 - financial_agent_modular - INFO - 正在获取 000002.SZ 的财务数据...
2025-07-12 22:26:26 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:26:26 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:26:26 - financial_agent_modular - INFO - 财务健康度评分: 34.0 (CCC)
2025-07-12 22:26:26 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:27:13 - financial_agent_modular - INFO - 财务健康度分析完成: 000002.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[5.盈利能力分析] ROE分析
查询: 贵州茅台的净资产收益率分析
期望: 成功
2025-07-12 22:27:13 - financial_agent_modular - INFO - 收到财务分析查询: 贵州茅台的净资产收益率分析
2025-07-12 22:27:13 - unified_stock_validator - INFO - 从查询词 '贵州茅台' 转换为: 600519.SH
2025-07-12 22:27:13 - unified_stock_validator - INFO - 从查询中提取到股票: 600519.SH
2025-07-12 22:27:13 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comprehensive
2025-07-12 22:27:13 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 产收益率
2025-07-12 22:27:13 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:27:13 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:27:13 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:27:13 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:27:13 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:27:13 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:27:13 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:27:13 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:27:13 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:27:13 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:27:13 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:27:57 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

负向测试用例:

[5.盈利能力分析] 歧义简称
查询: 平安的盈利
期望: 失败
2025-07-12 22:27:57 - financial_agent_modular - INFO - 收到财务分析查询: 平安的盈利
2025-07-12 22:27:57 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 平安
2025-07-12 22:27:57 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 盈利
2025-07-12 22:27:57 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:27:57 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:27:57 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[5.盈利能力分析] 缺少股票
查询: 盈利能力
期望: 失败
2025-07-12 22:27:57 - financial_agent_modular - INFO - 收到财务分析查询: 盈利能力
2025-07-12 22:27:57 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:27:57 - financial_agent_modular - INFO - 识别到分析类型: profitability
2025-07-12 22:27:57 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[5.盈利能力分析] 小写后缀
查询: 600000.sh盈利
期望: 失败
2025-07-12 22:27:57 - financial_agent_modular - INFO - 收到财务分析查询: 600000.sh盈利
2025-07-12 22:27:57 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sh
2025-07-12 22:27:57 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sh
2025-07-12 22:27:57 - parameter_extractor - WARNING - 股票验证失败: 证券代码后缀大小写错误，应为.SH
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 600000
2025-07-12 22:27:57 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:27:57 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sh
2025-07-12 22:27:57 - unified_stock_validator - WARNING - 证券代码后缀大小写错误: sh
2025-07-12 22:27:57 - parameter_extractor - WARNING - 股票验证失败: 证券代码后缀大小写错误，应为.SH
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 600000
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[5.盈利能力分析] 非A股
查询: 特斯拉的盈利能力
期望: 失败
2025-07-12 22:27:57 - financial_agent_modular - INFO - 收到财务分析查询: 特斯拉的盈利能力
2025-07-12 22:27:57 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 特斯拉
2025-07-12 22:27:57 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:27:57 - financial_agent_modular - INFO - 识别到分析类型: profitability
2025-07-12 22:27:57 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

============================================================
测试类别: 6.偿债能力分析
============================================================

正向测试用例:

[6.偿债能力分析] 完整名称
查询: 分析万科A的偿债能力
期望: 成功
2025-07-12 22:27:57 - financial_agent_modular - INFO - 收到财务分析查询: 分析万科A的偿债能力
2025-07-12 22:27:57 - unified_stock_validator - INFO - 从查询词 '万科A' 转换为: 000002.SZ
2025-07-12 22:27:57 - unified_stock_validator - INFO - 从查询中提取到股票: 000002.SZ
2025-07-12 22:27:57 - unified_stock_validator - INFO - 成功提取股票代码: 000002.SZ, 查询意图: comprehensive
2025-07-12 22:27:57 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 偿债能力
2025-07-12 22:27:57 - stock_validation_helper - INFO - 股票验证成功: 000002.SZ -> 000002.SZ (万科A)
2025-07-12 22:27:57 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:27:57 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:27:57 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:27:57 - financial_agent_modular - INFO - 识别到分析类型: solvency
2025-07-12 22:27:57 - financial_agent_modular - INFO - 开始分析 000002.SZ 的财务健康度
2025-07-12 22:27:57 - financial_agent_modular - INFO - 正在获取 000002.SZ 的财务数据...
2025-07-12 22:27:57 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:27:57 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:27:57 - financial_agent_modular - INFO - 财务健康度评分: 34.0 (CCC)
2025-07-12 22:27:57 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:28:48 - financial_agent_modular - INFO - 财务健康度分析完成: 000002.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[6.偿债能力分析] 股票代码
查询: 分析601939.SH的偿债能力
期望: 成功
2025-07-12 22:28:48 - financial_agent_modular - INFO - 收到财务分析查询: 分析601939.SH的偿债能力
2025-07-12 22:28:48 - unified_stock_validator - INFO - 成功提取股票代码: 601939.SH, 查询意图: solvency
2025-07-12 22:28:48 - stock_validation_helper - INFO - 股票验证成功: 601939.SH -> 601939.SH (建设银行)
2025-07-12 22:28:48 - parameter_extractor - INFO - 提取到股票: ['601939.SH']
2025-07-12 22:28:48 - parameter_extractor - INFO - 提取到股票: ['601939.SH']
2025-07-12 22:28:48 - parameter_extractor - INFO - 数量限制: 601939
2025-07-12 22:28:48 - financial_agent_modular - INFO - 识别到分析类型: solvency
2025-07-12 22:28:48 - financial_agent_modular - INFO - 开始分析 601939.SH 的财务健康度
2025-07-12 22:28:48 - financial_agent_modular - INFO - 正在获取 601939.SH 的财务数据...
2025-07-12 22:28:48 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:28:48 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:28:48 - financial_agent_modular - INFO - 财务健康度评分: 57.0 (BB)
2025-07-12 22:28:48 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:29:36 - financial_agent_modular - INFO - 财务健康度分析完成: 601939.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[6.偿债能力分析] 流动比率
查询: 贵州茅台的流动比率
期望: 成功
2025-07-12 22:29:36 - financial_agent_modular - INFO - 收到财务分析查询: 贵州茅台的流动比率
2025-07-12 22:29:36 - unified_stock_validator - INFO - 从查询词 '贵州茅台' 转换为: 600519.SH
2025-07-12 22:29:36 - unified_stock_validator - INFO - 从查询中提取到股票: 600519.SH
2025-07-12 22:29:36 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comprehensive
2025-07-12 22:29:36 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 流动比率
2025-07-12 22:29:36 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:29:36 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:29:36 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:29:36 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:29:36 - financial_agent_modular - INFO - 识别到分析类型: solvency
2025-07-12 22:29:36 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:29:36 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:29:36 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:29:36 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:29:36 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:29:36 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:30:20 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[6.偿债能力分析] 负债率
查询: 平安银行的资产负债率
期望: 成功
2025-07-12 22:30:20 - financial_agent_modular - INFO - 收到财务分析查询: 平安银行的资产负债率
2025-07-12 22:30:20 - unified_stock_validator - INFO - 从查询中提取到股票名称 '平安银行'，转换为: 000001.SZ
2025-07-12 22:30:20 - unified_stock_validator - INFO - 从查询中提取到股票: 000001.SZ
2025-07-12 22:30:20 - unified_stock_validator - INFO - 成功提取股票代码: 000001.SZ, 查询意图: comprehensive
2025-07-12 22:30:20 - unified_stock_validator - INFO - 从查询中提取到股票名称 '平安银行'，转换为: 000001.SZ
2025-07-12 22:30:20 - unified_stock_validator - INFO - 从查询中提取到股票: 000001.SZ
2025-07-12 22:30:20 - unified_stock_validator - INFO - 成功提取股票代码: 000001.SZ, 查询意图: comprehensive
2025-07-12 22:30:20 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 资产负债率
2025-07-12 22:30:20 - stock_validation_helper - INFO - 股票验证成功: 000001.SZ -> 000001.SZ (平安银行)
2025-07-12 22:30:20 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:30:20 - parameter_extractor - INFO - 提取到股票: ['000001.SZ']
2025-07-12 22:30:20 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:30:20 - financial_agent_modular - INFO - 识别到分析类型: solvency
2025-07-12 22:30:20 - financial_agent_modular - INFO - 开始分析 000001.SZ 的财务健康度
2025-07-12 22:30:20 - financial_agent_modular - INFO - 正在获取 000001.SZ 的财务数据...
2025-07-12 22:30:20 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:30:20 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:30:20 - financial_agent_modular - INFO - 财务健康度评分: 57.0 (BB)
2025-07-12 22:30:20 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:31:02 - financial_agent_modular - INFO - 财务健康度分析完成: 000001.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

负向测试用例:

[6.偿债能力分析] 股票简称
查询: 建行的偿债
期望: 失败
2025-07-12 22:31:02 - financial_agent_modular - INFO - 收到财务分析查询: 建行的偿债
2025-07-12 22:31:02 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 建行
2025-07-12 22:31:02 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 偿债
2025-07-12 22:31:02 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:31:02 - financial_agent_modular - INFO - 识别到分析类型: solvency
2025-07-12 22:31:02 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[6.偿债能力分析] 缺少股票
查询: 偿债能力分析
期望: 失败
2025-07-12 22:31:02 - financial_agent_modular - INFO - 收到财务分析查询: 偿债能力分析
2025-07-12 22:31:02 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:31:02 - financial_agent_modular - INFO - 识别到分析类型: solvency
2025-07-12 22:31:02 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[6.偿债能力分析] 无效代码
查询: 000000的偿债
期望: 失败
2025-07-12 22:31:02 - financial_agent_modular - INFO - 收到财务分析查询: 000000的偿债
2025-07-12 22:31:02 - mysql_connector - ERROR - 查询执行失败: List argument must consist only of tuples or dictionaries
2025-07-12 22:31:02 - mysql_connector - ERROR - 查询语句: 
            SELECT ts_code 
            FROM tu_stock_basic 
            WHERE symbol = %s AND list_status = 'L'
            LIMIT 1
            
2025-07-12 22:31:02 - stock_code_mapper - ERROR - 查询symbol失败: List argument must consist only of tuples or dictionaries
2025-07-12 22:31:02 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:31:02 - financial_agent_modular - INFO - 识别到分析类型: solvency
2025-07-12 22:31:02 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[6.偿债能力分析] 错误长度
查询: 60051的偿债能力
期望: 失败
2025-07-12 22:31:02 - financial_agent_modular - INFO - 收到财务分析查询: 60051的偿债能力
2025-07-12 22:31:02 - unified_stock_validator - WARNING - 股票代码长度不正确: 60051 (应为6位)
2025-07-12 22:31:02 - unified_stock_validator - WARNING - 股票代码长度不正确: 60051 (应为6位)
2025-07-12 22:31:02 - parameter_extractor - WARNING - 股票验证失败: 股票代码应为6位数字，您输入了5位
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 60051
2025-07-12 22:31:02 - financial_agent_modular - INFO - 识别到分析类型: solvency
2025-07-12 22:31:02 - unified_stock_validator - WARNING - 股票代码长度不正确: 60051 (应为6位)
2025-07-12 22:31:02 - unified_stock_validator - WARNING - 股票代码长度不正确: 60051 (应为6位)
2025-07-12 22:31:02 - parameter_extractor - WARNING - 股票验证失败: 股票代码应为6位数字，您输入了5位
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 60051
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

============================================================
测试类别: 7.运营能力分析
============================================================

正向测试用例:

[7.运营能力分析] 完整名称
查询: 分析海尔智家的运营效率
期望: 成功
2025-07-12 22:31:02 - financial_agent_modular - INFO - 收到财务分析查询: 分析海尔智家的运营效率
2025-07-12 22:31:02 - unified_stock_validator - INFO - 从查询词 '海尔智家' 转换为: 600690.SH
2025-07-12 22:31:02 - unified_stock_validator - INFO - 从查询中提取到股票: 600690.SH
2025-07-12 22:31:02 - unified_stock_validator - INFO - 成功提取股票代码: 600690.SH, 查询意图: comprehensive
2025-07-12 22:31:02 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 运营效率
2025-07-12 22:31:02 - stock_validation_helper - INFO - 股票验证成功: 600690.SH -> 600690.SH (海尔智家)
2025-07-12 22:31:02 - parameter_extractor - INFO - 提取到股票: ['600690.SH']
2025-07-12 22:31:02 - parameter_extractor - INFO - 提取到股票: ['600690.SH']
2025-07-12 22:31:02 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:31:02 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:31:02 - financial_agent_modular - INFO - 开始分析 600690.SH 的财务健康度
2025-07-12 22:31:02 - financial_agent_modular - INFO - 正在获取 600690.SH 的财务数据...
2025-07-12 22:31:02 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:31:02 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:31:02 - financial_agent_modular - INFO - 财务健康度评分: 47.5 (B)
2025-07-12 22:31:02 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:31:47 - financial_agent_modular - INFO - 财务健康度分析完成: 600690.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[7.运营能力分析] 股票代码
查询: 分析600690.SH的运营能力
期望: 成功
2025-07-12 22:31:47 - financial_agent_modular - INFO - 收到财务分析查询: 分析600690.SH的运营能力
2025-07-12 22:31:47 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 运营能力
2025-07-12 22:31:47 - unified_stock_validator - INFO - 成功提取股票代码: 600690.SH, 查询意图: comprehensive
2025-07-12 22:31:47 - stock_validation_helper - INFO - 股票验证成功: 600690.SH -> 600690.SH (海尔智家)
2025-07-12 22:31:47 - parameter_extractor - INFO - 提取到股票: ['600690.SH']
2025-07-12 22:31:47 - parameter_extractor - INFO - 提取到股票: ['600690.SH']
2025-07-12 22:31:47 - parameter_extractor - INFO - 数量限制: 600690
2025-07-12 22:31:47 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:31:47 - financial_agent_modular - INFO - 开始分析 600690.SH 的财务健康度
2025-07-12 22:31:47 - financial_agent_modular - INFO - 正在获取 600690.SH 的财务数据...
2025-07-12 22:31:47 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:31:47 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:31:47 - financial_agent_modular - INFO - 财务健康度评分: 47.5 (B)
2025-07-12 22:31:47 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:32:33 - financial_agent_modular - INFO - 财务健康度分析完成: 600690.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[7.运营能力分析] 存货周转
查询: 万科A的存货周转率
期望: 成功
2025-07-12 22:32:33 - financial_agent_modular - INFO - 收到财务分析查询: 万科A的存货周转率
2025-07-12 22:32:33 - unified_stock_validator - INFO - 从查询中提取到股票名称 '万科A'，转换为: 000002.SZ
2025-07-12 22:32:33 - unified_stock_validator - INFO - 从查询中提取到股票: 000002.SZ
2025-07-12 22:32:33 - unified_stock_validator - INFO - 成功提取股票代码: 000002.SZ, 查询意图: comprehensive
2025-07-12 22:32:33 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 存货周转率
2025-07-12 22:32:33 - stock_validation_helper - INFO - 股票验证成功: 000002.SZ -> 000002.SZ (万科A)
2025-07-12 22:32:33 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:32:33 - parameter_extractor - INFO - 提取到股票: ['000002.SZ']
2025-07-12 22:32:33 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:32:33 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:32:33 - financial_agent_modular - INFO - 开始分析 000002.SZ 的财务健康度
2025-07-12 22:32:33 - financial_agent_modular - INFO - 正在获取 000002.SZ 的财务数据...
2025-07-12 22:32:33 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:32:33 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:32:33 - financial_agent_modular - INFO - 财务健康度评分: 34.0 (CCC)
2025-07-12 22:32:33 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:33:21 - financial_agent_modular - INFO - 财务健康度分析完成: 000002.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[7.运营能力分析] 能力评价
查询: 贵州茅台的运营能力评价
期望: 成功
2025-07-12 22:33:21 - financial_agent_modular - INFO - 收到财务分析查询: 贵州茅台的运营能力评价
2025-07-12 22:33:21 - unified_stock_validator - INFO - 从查询词 '贵州茅台' 转换为: 600519.SH
2025-07-12 22:33:21 - unified_stock_validator - INFO - 从查询中提取到股票: 600519.SH
2025-07-12 22:33:21 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comprehensive
2025-07-12 22:33:21 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 运营能力评价
2025-07-12 22:33:21 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:33:21 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:33:21 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:33:21 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:33:21 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:33:21 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:33:21 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:33:21 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:33:21 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:33:21 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:33:21 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:34:07 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

负向测试用例:

[7.运营能力分析] 股票简称
查询: 格力的运营
期望: 失败
2025-07-12 22:34:07 - financial_agent_modular - INFO - 收到财务分析查询: 格力的运营
2025-07-12 22:34:07 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 格力
2025-07-12 22:34:07 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 运营
2025-07-12 22:34:07 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:34:07 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:34:07 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[7.运营能力分析] 缺少股票
查询: 运营效率
期望: 失败
2025-07-12 22:34:07 - financial_agent_modular - INFO - 收到财务分析查询: 运营效率
2025-07-12 22:34:07 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:34:07 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:34:07 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[7.运营能力分析] 7位代码
查询: 1234567运营
期望: 失败
2025-07-12 22:34:07 - financial_agent_modular - INFO - 收到财务分析查询: 1234567运营
2025-07-12 22:34:07 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 1234567运营
2025-07-12 22:34:07 - unified_stock_validator - WARNING - 股票代码长度不正确: 1234567 (应为6位)
2025-07-12 22:34:07 - unified_stock_validator - WARNING - 股票代码长度不正确: 1234567 (应为6位)
2025-07-12 22:34:07 - parameter_extractor - WARNING - 股票验证失败: 股票代码应为6位数字，您输入了7位
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 1234567
2025-07-12 22:34:07 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:34:07 - unified_stock_validator - WARNING - 股票代码长度不正确: 1234567 (应为6位)
2025-07-12 22:34:07 - unified_stock_validator - WARNING - 股票代码长度不正确: 1234567 (应为6位)
2025-07-12 22:34:07 - parameter_extractor - WARNING - 股票验证失败: 股票代码应为6位数字，您输入了7位
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 1234567
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[7.运营能力分析] 错误后缀
查询: 600690.BJ的运营
期望: 失败
2025-07-12 22:34:07 - financial_agent_modular - INFO - 收到财务分析查询: 600690.BJ的运营
2025-07-12 22:34:07 - stock_code_mapper - WARNING - 无法转换实体到ts_code: BJ的运营
2025-07-12 22:34:07 - stock_code_mapper - WARNING - 无法转换实体到ts_code: BJ
2025-07-12 22:34:07 - unified_stock_validator - WARNING - 股票代码不存在: 600690.BJ
2025-07-12 22:34:07 - unified_stock_validator - WARNING - 股票代码不存在: 600690.BJ
2025-07-12 22:34:07 - parameter_extractor - WARNING - 股票验证失败: 股票代码600690.BJ不存在，请检查是否输入正确
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 600690
2025-07-12 22:34:07 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:34:07 - unified_stock_validator - WARNING - 股票代码不存在: 600690.BJ
2025-07-12 22:34:07 - unified_stock_validator - WARNING - 股票代码不存在: 600690.BJ
2025-07-12 22:34:07 - parameter_extractor - WARNING - 股票验证失败: 股票代码600690.BJ不存在，请检查是否输入正确
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 600690
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

============================================================
测试类别: 8.成长能力分析
============================================================

正向测试用例:

[8.成长能力分析] 完整名称
查询: 分析宁德时代的成长性
期望: 成功
2025-07-12 22:34:07 - financial_agent_modular - INFO - 收到财务分析查询: 分析宁德时代的成长性
2025-07-12 22:34:07 - unified_stock_validator - INFO - 从查询词 '宁德时代' 转换为: 300750.SZ
2025-07-12 22:34:07 - unified_stock_validator - INFO - 从查询中提取到股票: 300750.SZ
2025-07-12 22:34:07 - unified_stock_validator - INFO - 成功提取股票代码: 300750.SZ, 查询意图: comprehensive
2025-07-12 22:34:07 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 成长性
2025-07-12 22:34:07 - stock_validation_helper - INFO - 股票验证成功: 300750.SZ -> 300750.SZ (宁德时代)
2025-07-12 22:34:07 - parameter_extractor - INFO - 提取到股票: ['300750.SZ']
2025-07-12 22:34:07 - parameter_extractor - INFO - 提取到股票: ['300750.SZ']
2025-07-12 22:34:07 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:34:07 - financial_agent_modular - INFO - 识别到分析类型: growth
2025-07-12 22:34:07 - financial_agent_modular - INFO - 开始分析 300750.SZ 的财务健康度
2025-07-12 22:34:07 - financial_agent_modular - INFO - 正在获取 300750.SZ 的财务数据...
2025-07-12 22:34:07 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:34:07 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:34:07 - financial_agent_modular - INFO - 财务健康度评分: 69.0 (BBB)
2025-07-12 22:34:07 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:34:53 - financial_agent_modular - INFO - 财务健康度分析完成: 300750.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[8.成长能力分析] 股票代码
查询: 分析300750.SZ的成长能力
期望: 成功
2025-07-12 22:34:53 - financial_agent_modular - INFO - 收到财务分析查询: 分析300750.SZ的成长能力
2025-07-12 22:34:53 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 成长能力
2025-07-12 22:34:53 - unified_stock_validator - INFO - 成功提取股票代码: 300750.SZ, 查询意图: comprehensive
2025-07-12 22:34:53 - stock_validation_helper - INFO - 股票验证成功: 300750.SZ -> 300750.SZ (宁德时代)
2025-07-12 22:34:53 - parameter_extractor - INFO - 提取到股票: ['300750.SZ']
2025-07-12 22:34:53 - parameter_extractor - INFO - 提取到股票: ['300750.SZ']
2025-07-12 22:34:53 - parameter_extractor - INFO - 数量限制: 300750
2025-07-12 22:34:53 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:34:53 - financial_agent_modular - INFO - 开始分析 300750.SZ 的财务健康度
2025-07-12 22:34:53 - financial_agent_modular - INFO - 正在获取 300750.SZ 的财务数据...
2025-07-12 22:34:54 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:34:54 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:34:54 - financial_agent_modular - INFO - 财务健康度评分: 69.0 (BBB)
2025-07-12 22:34:54 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:35:46 - financial_agent_modular - INFO - 财务健康度分析完成: 300750.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[8.成长能力分析] 营收增长
查询: 贵州茅台的营收增长率
期望: 成功
2025-07-12 22:35:46 - financial_agent_modular - INFO - 收到财务分析查询: 贵州茅台的营收增长率
2025-07-12 22:35:46 - unified_stock_validator - INFO - 从查询词 '贵州茅台' 转换为: 600519.SH
2025-07-12 22:35:46 - unified_stock_validator - INFO - 从查询中提取到股票: 600519.SH
2025-07-12 22:35:46 - unified_stock_validator - INFO - 成功提取股票代码: 600519.SH, 查询意图: comprehensive
2025-07-12 22:35:46 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 营收增长率
2025-07-12 22:35:46 - stock_validation_helper - INFO - 股票验证成功: 600519.SH -> 600519.SH (贵州茅台)
2025-07-12 22:35:46 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:35:46 - parameter_extractor - INFO - 提取到股票: ['600519.SH']
2025-07-12 22:35:46 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:35:46 - financial_agent_modular - INFO - 识别到分析类型: growth
2025-07-12 22:35:46 - financial_agent_modular - INFO - 开始分析 600519.SH 的财务健康度
2025-07-12 22:35:46 - financial_agent_modular - INFO - 正在获取 600519.SH 的财务数据...
2025-07-12 22:35:46 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:35:46 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:35:46 - financial_agent_modular - INFO - 财务健康度评分: 81.0 (AA)
2025-07-12 22:35:46 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:36:37 - financial_agent_modular - INFO - 财务健康度分析完成: 600519.SH
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[8.成长能力分析] 利润增长
查询: 比亚迪的利润增长情况
期望: 成功
2025-07-12 22:36:37 - financial_agent_modular - INFO - 收到财务分析查询: 比亚迪的利润增长情况
2025-07-12 22:36:37 - unified_stock_validator - INFO - 从查询词 '比亚迪' 转换为: 002594.SZ
2025-07-12 22:36:37 - unified_stock_validator - INFO - 从查询中提取到股票: 002594.SZ
2025-07-12 22:36:37 - unified_stock_validator - INFO - 成功提取股票代码: 002594.SZ, 查询意图: comprehensive
2025-07-12 22:36:37 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 利润增长情况
2025-07-12 22:36:37 - stock_validation_helper - INFO - 股票验证成功: 002594.SZ -> 002594.SZ (比亚迪)
2025-07-12 22:36:37 - parameter_extractor - INFO - 提取到股票: ['002594.SZ']
2025-07-12 22:36:37 - parameter_extractor - INFO - 提取到股票: ['002594.SZ']
2025-07-12 22:36:37 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:36:37 - financial_agent_modular - INFO - 识别到分析类型: growth
2025-07-12 22:36:37 - financial_agent_modular - INFO - 开始分析 002594.SZ 的财务健康度
2025-07-12 22:36:37 - financial_agent_modular - INFO - 正在获取 002594.SZ 的财务数据...
2025-07-12 22:36:37 - financial_agent_modular - INFO - 成功获取 4 期财务数据
2025-07-12 22:36:37 - financial_agent_modular - INFO - 正在计算财务健康度评分...
2025-07-12 22:36:37 - financial_agent_modular - INFO - 财务健康度评分: 42.5 (B)
2025-07-12 22:36:37 - financial_agent_modular - INFO - 正在生成LLM分析报告...
2025-07-12 22:37:17 - financial_agent_modular - INFO - 财务健康度分析完成: 002594.SZ
实际: 成功
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

负向测试用例:

[8.成长能力分析] 股票简称
查询: 宁德的成长性
期望: 失败
2025-07-12 22:37:17 - financial_agent_modular - INFO - 收到财务分析查询: 宁德的成长性
2025-07-12 22:37:17 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 宁德
2025-07-12 22:37:17 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:37:17 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:37:17 - financial_agent_modular - INFO - 识别到分析类型: growth
2025-07-12 22:37:17 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:37:17 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[8.成长能力分析] 缺少股票
查询: 成长性分析
期望: 失败
2025-07-12 22:37:17 - financial_agent_modular - INFO - 收到财务分析查询: 成长性分析
2025-07-12 22:37:17 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:37:17 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:37:17 - financial_agent_modular - INFO - 识别到分析类型: growth
2025-07-12 22:37:17 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:37:17 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[8.成长能力分析] 非A股
查询: 特斯拉的成长
期望: 失败
2025-07-12 22:37:17 - financial_agent_modular - INFO - 收到财务分析查询: 特斯拉的成长
2025-07-12 22:37:17 - stock_code_mapper - WARNING - 无法转换实体到ts_code: 成长
2025-07-12 22:37:17 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:37:17 - parameter_extractor - INFO - 数量限制: 10
2025-07-12 22:37:17 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:37:17 - parameter_extractor - WARNING - 股票验证失败: 无法识别输入内容。请输入：1) 6位股票代码（如002047）2) 证券代码（如600519.SH）3) 股票名称（如贵州茅台）
2025-07-12 22:37:17 - parameter_extractor - INFO - 数量限制: 10
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

[8.成长能力分析] 错误后缀
查询: 600519.SZ成长
期望: 失败
2025-07-12 22:37:17 - financial_agent_modular - INFO - 收到财务分析查询: 600519.SZ成长
2025-07-12 22:37:17 - stock_code_mapper - WARNING - 无法转换实体到ts_code: SZ成长
2025-07-12 22:37:17 - unified_stock_validator - WARNING - 股票代码不存在: 600519.SZ
2025-07-12 22:37:17 - unified_stock_validator - WARNING - 股票代码不存在: 600519.SZ
2025-07-12 22:37:17 - parameter_extractor - WARNING - 股票验证失败: 股票代码600519.SZ不存在，请检查是否输入正确
2025-07-12 22:37:17 - parameter_extractor - INFO - 数量限制: 600519
2025-07-12 22:37:17 - financial_agent_modular - INFO - 识别到分析类型: financial_health
2025-07-12 22:37:17 - unified_stock_validator - WARNING - 股票代码不存在: 600519.SZ
2025-07-12 22:37:17 - unified_stock_validator - WARNING - 股票代码不存在: 600519.SZ
2025-07-12 22:37:17 - parameter_extractor - WARNING - 股票验证失败: 股票代码600519.SZ不存在，请检查是否输入正确
2025-07-12 22:37:17 - parameter_extractor - INFO - 数量限制: 600519
实际: 失败
异常: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

================================================================================
测试总结
================================================================================
总测试数: 128
通过: 64
失败: 64
通过率: 50.0%

分类统计:
1.财务健康度分析: 8/16 (50.0%)
2.杜邦分析: 8/16 (50.0%)
3.现金流质量分析: 8/16 (50.0%)
4.多期财务对比: 8/16 (50.0%)
5.盈利能力分析: 8/16 (50.0%)
6.偿债能力分析: 8/16 (50.0%)
7.运营能力分析: 8/16 (50.0%)
8.成长能力分析: 8/16 (50.0%)

失败测试详情:

1. [1.财务健康度分析] 完整名称
   查询: 分析贵州茅台的财务健康度
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

2. [1.财务健康度分析] 股票代码
   查询: 分析600519.SH的财务健康度
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

3. [1.财务健康度分析] 银行股
   查询: 分析平安银行的财务健康度
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

4. [1.财务健康度分析] 财务状况
   查询: 分析万科A的财务状况
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

5. [1.财务健康度分析] 股票简称
   查询: 茅台的财务健康度
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

6. [1.财务健康度分析] 空查询
   查询: 
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

7. [1.财务健康度分析] 错误代码
   查询: 12345的财务健康度
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

8. [1.财务健康度分析] 小写后缀
   查询: 600519.sh的财务健康度
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

9. [2.杜邦分析] 完整名称
   查询: 贵州茅台的杜邦分析
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

10. [2.杜邦分析] ROE分解
   查询: 平安银行ROE分解分析
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

11. [2.杜邦分析] 股票代码
   查询: 600519.SH的杜邦分析
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

12. [2.杜邦分析] 分析ROE
   查询: 分析万科A的ROE
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

13. [2.杜邦分析] 股票简称
   查询: 茅台的杜邦分析
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

14. [2.杜邦分析] 缺少股票
   查询: 杜邦分析
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

15. [2.杜邦分析] 小写后缀
   查询: 600519.sz的杜邦分析
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

16. [2.杜邦分析] 无效股票
   查询: 不存在公司的杜邦分析
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

17. [3.现金流质量分析] 完整名称
   查询: 分析万科A的现金流质量
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

18. [3.现金流质量分析] 股票代码
   查询: 分析000002.SZ的现金流质量
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

19. [3.现金流质量分析] 评估
   查询: 评估平安银行的现金流
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

20. [3.现金流质量分析] 含量比率
   查询: 贵州茅台的现金含量比率
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

21. [3.现金流质量分析] 股票简称
   查询: 万科的现金流
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

22. [3.现金流质量分析] 缺少股票
   查询: 现金流质量
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

23. [3.现金流质量分析] 空白查询
   查询:    
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

24. [3.现金流质量分析] 错误后缀
   查询: 000002.SH的现金流
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

25. [4.多期财务对比] 指定期数
   查询: 贵州茅台最近3期财务对比
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

26. [4.多期财务对比] 财务变化
   查询: 600519.SH最近几期的财务变化
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

27. [4.多期财务对比] 财务趋势
   查询: 分析平安银行的财务趋势
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

28. [4.多期财务对比] 季度对比
   查询: 万科A的季度财务对比分析
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

29. [4.多期财务对比] 股票简称
   查询: 茅台对比
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

30. [4.多期财务对比] 缺少股票
   查询: 财务对比
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

31. [4.多期财务对比] 无效代码
   查询: 123456最近的对比
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

32. [4.多期财务对比] 小写后缀
   查询: 600519.sz财务对比
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

33. [5.盈利能力分析] 完整名称
   查询: 分析比亚迪的盈利能力
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

34. [5.盈利能力分析] 股票代码
   查询: 分析002594.SZ的盈利能力
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

35. [5.盈利能力分析] 毛利率
   查询: 万科A的毛利率分析
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

36. [5.盈利能力分析] ROE分析
   查询: 贵州茅台的净资产收益率分析
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

37. [5.盈利能力分析] 歧义简称
   查询: 平安的盈利
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

38. [5.盈利能力分析] 缺少股票
   查询: 盈利能力
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

39. [5.盈利能力分析] 小写后缀
   查询: 600000.sh盈利
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

40. [5.盈利能力分析] 非A股
   查询: 特斯拉的盈利能力
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

41. [6.偿债能力分析] 完整名称
   查询: 分析万科A的偿债能力
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

42. [6.偿债能力分析] 股票代码
   查询: 分析601939.SH的偿债能力
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

43. [6.偿债能力分析] 流动比率
   查询: 贵州茅台的流动比率
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

44. [6.偿债能力分析] 负债率
   查询: 平安银行的资产负债率
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

45. [6.偿债能力分析] 股票简称
   查询: 建行的偿债
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

46. [6.偿债能力分析] 缺少股票
   查询: 偿债能力分析
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

47. [6.偿债能力分析] 无效代码
   查询: 000000的偿债
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

48. [6.偿债能力分析] 错误长度
   查询: 60051的偿债能力
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

49. [7.运营能力分析] 完整名称
   查询: 分析海尔智家的运营效率
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

50. [7.运营能力分析] 股票代码
   查询: 分析600690.SH的运营能力
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

51. [7.运营能力分析] 存货周转
   查询: 万科A的存货周转率
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

52. [7.运营能力分析] 能力评价
   查询: 贵州茅台的运营能力评价
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

53. [7.运营能力分析] 股票简称
   查询: 格力的运营
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

54. [7.运营能力分析] 缺少股票
   查询: 运营效率
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

55. [7.运营能力分析] 7位代码
   查询: 1234567运营
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

56. [7.运营能力分析] 错误后缀
   查询: 600690.BJ的运营
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

57. [8.成长能力分析] 完整名称
   查询: 分析宁德时代的成长性
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

58. [8.成长能力分析] 股票代码
   查询: 分析300750.SZ的成长能力
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

59. [8.成长能力分析] 营收增长
   查询: 贵州茅台的营收增长率
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

60. [8.成长能力分析] 利润增长
   查询: 比亚迪的利润增长情况
   期望: 成功
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

61. [8.成长能力分析] 股票简称
   查询: 宁德的成长性
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

62. [8.成长能力分析] 缺少股票
   查询: 成长性分析
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

63. [8.成长能力分析] 非A股
   查询: 特斯拉的成长
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

64. [8.成长能力分析] 错误后缀
   查询: 600519.SZ成长
   期望: 失败
   实际: 失败
   错误: Exception: 'gbk' codec can't encode character '\u2705' in position 4: illegal multibyte sequence

测试报告已保存到: test_financial_agent_report_20250712_223717.json
